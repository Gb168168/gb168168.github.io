<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>GoldBricks 訂餐系統 - 管理者</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f4fb;
      min-height: 100vh;
      display: flex;
    }
    .sidebar {
      width: 220px;
      background: #111827;
      color: #e5e7eb;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .sidebar h2 { font-size: 18px; margin-bottom: 4px; }
    .menu { list-style: none; margin-top: 8px; }
    .menu li {
      padding: 8px 10px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 4px;
    }
    .menu li.active {
      background: linear-gradient(90deg,#fb7185,#f97316);
      color: white;
    }
    .menu li:hover:not(.active) { background: #1f2937; }

    .main {
      flex: 1;
      padding: 20px 24px;
      overflow-y: auto;
    }
    .section { display: none; }
    .section.active { display: block; }

    h3 { font-size: 18px; margin-bottom: 12px; }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 8px 25px rgba(15,23,42,0.08);
      margin-bottom: 16px;
    }
    .group {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 12px 16px;
      margin-bottom: 12px;
    }
    label {
      font-size: 13px;
      color: #374151;
      margin-bottom: 4px;
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    textarea { resize: vertical; min-height: 60px; }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #fb7185;
      box-shadow: 0 0 0 2px rgba(251,113,133,0.2);
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg,#fb7185,#f97316);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
    }
    .btn.secondary { background: #e5e7eb; color: #111827; }
    .btn.sm { padding: 4px 10px; font-size: 12px; }
    .btn.danger { background: #ef4444; color: #fff; }
    .flex { display: flex; gap: 8px; align-items: center; }
    .mt-8  { margin-top: 8px; }
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }
    .list {
      margin-top: 8px;
      border-top: 1px solid #e5e7eb;
      padding-top: 8px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }
    /* 1-1 新增人員列表不要捲動，直接展開 */
    #staff-list {
      max-height: none;
      overflow: visible;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #f3f4f6;
      color: #4b5563;
      margin-right: 4px;
    }
    details {
      border-radius: 10px;
      background: #f9fafb;
      padding: 6px 10px;
      margin-bottom: 6px;
    }
    summary { cursor: pointer; font-size: 13px; font-weight: 600; }
    .staff-pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      margin: 4px 4px 0 0;
    }
    .staff-pill button {
      margin-left: 4px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 12px;
      color: #6b7280;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .topbar .info { font-size: 13px; color: #6b7280; }

    /* 餐廳卡片 */
    .restaurant-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
      gap: 16px;
      margin-top: 8px;
    }
    .restaurant-card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 8px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .restaurant-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(15,23,42,0.12);
    }
    .restaurant-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
      background: #e5e7eb;
    }
    .restaurant-card-name {
      margin-top: 6px;
      font-size: 14px;
      font-weight: 600;
      color: #111827;
    }
    .restaurant-card-sub {
      font-size: 12px;
      color: #6b7280;
    }

    /* 餐點表格 */
    table { border-collapse: collapse; width: 100%; }
    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }
    th {
      background:#f9fafb;
      font-size:12px;
      color:#6b7280;
    }
    td { font-size:13px; }
  </style>
</head>
<body>
  <!-- 左側選單 -->
  <aside class="sidebar">
    <div>
      <h2>管理者後台</h2>
      <div style="font-size:12px;color:#9ca3af;">GoldBricks 訂餐系統</div>
    </div>
    <ul class="menu" id="menu">
      <li data-target="section-add-staff">1-1 新增人員</li>
      <li data-target="section-add-restaurant" class="active">1-2 餐廳管理</li>
      <li data-target="section-restaurants">1-3 餐廳管理（總覽）</li>
      <li data-target="section-orders">1-4 訂餐紀錄</li>
      <li data-target="section-stats">1-5 訂單統計</li>
      <li id="switchToUser">1-6 切換使用者模式</li>
      <li id="logout">1-7 登出</li>
    </ul>
  </aside>

  <!-- 右側內容 -->
  <main class="main">
    <div class="topbar">
      <div>
        <h3>新增餐廳</h3>
        <div class="info">一進頁面先顯示「新增餐廳」區塊</div>
      </div>
      <div class="info">目前身分：管理者</div>
    </div>

    <!-- 1-2 新增餐廳 ＋ 餐點管理 -->
    <section id="section-add-restaurant" class="section active">
      <div class="card">
        <h3>2-1 餐廳管理</h3>
        <div class="group mt-8">
          <div>
            <label>餐廳名稱</label>
            <input id="rest-name" placeholder="例：小王便當" />
          </div>
          <div>
            <label>電話</label>
            <input id="rest-phone" placeholder="02-1234-5678" />
          </div>
          <div>
            <label>地址</label>
            <input id="rest-address" placeholder="台北市..." />
          </div>
          <div>
            <label>Google Map 連結</label>
            <input id="rest-map" placeholder="Google Map URL" />
          </div>
          <div>
            <label>店家圖片</label>
            <input type="file" id="rest-image" accept="image/*" />
          </div>
        </div>
        <div class="mt-8">
          <label>備註</label>
          <textarea id="rest-note" placeholder="例如：只收現金、可先電話預訂等..."></textarea>
        </div>
        <button class="btn mt-12" id="btn-add-restaurant">新增餐廳</button>

        <div class="list" id="restaurant-list"></div>
      </div>

      <div class="card">
        <h3>2-2 餐點管理</h3>
        <div class="group mt-8">
          <div>
            <label>餐廳名稱</label>
            <select id="menu-rest-select">
              <option value="">請先新增餐廳</option>
            </select>
          </div>
          <div>
            <label>餐點類別</label>
            <!-- 類別輸入 + 歷史選項 -->
            <input id="menu-category" list="category-list" placeholder="輸入餐點類別，如：飯類 / 湯品 / 飲料" />
            <datalist id="category-list"></datalist>
          </div>
          <div>
            <label>餐點名稱</label>
            <input id="menu-name" placeholder="例：排骨飯" />
          </div>
          <div>
            <label>價格（單份）</label>
            <input id="menu-price" type="number" min="0" step="1" value="0" />
          </div>
          <div>
            <label>預設數量</label>
            <input id="menu-default-qty" type="number" min="1" step="1" value="1" />
          </div>
        </div>

        <!-- 加購項目 -->
        <div class="mt-12">
          <label>加購項目</label>
          <div id="addons-container"></div>
          <button class="btn secondary sm mt-8" id="btn-add-addon">＋ 新增一個加購</button>
        </div>

        <button class="btn mt-12" id="btn-add-menu">新增餐點</button>

        <div class="list" id="menu-list"></div>
      </div>
    </section>

    <!-- 1-3 餐廳管理（總覽 & 編輯） -->
    <section id="section-restaurants" class="section">
      <div class="card">
        <h3>1-3 餐廳管理（點圖片可編輯）</h3>
        <div class="restaurant-grid" id="restaurant-cards"></div>
      </div>

      <div class="card" id="restaurant-edit-panel" style="display:none;">
        <h3>編輯餐廳資訊</h3>
        <div class="group mt-8">
          <div>
            <label>餐廳名稱</label>
            <input id="edit-rest-name" />
          </div>
          <div>
            <label>電話</label>
            <input id="edit-rest-phone" />
          </div>
          <div>
            <label>地址</label>
            <input id="edit-rest-address" />
          </div>
          <div>
            <label>Google Map 連結</label>
            <input id="edit-rest-map" />
          </div>
        </div>
        <div class="mt-8">
          <label>備註</label>
          <textarea id="edit-rest-note"></textarea>
        </div>
        <button class="btn mt-12" id="btn-save-rest">儲存修改</button>

        <!-- 餐點列表（表格 + 刪除） -->
        <div class="mt-16">
          <h4 style="font-size:15px;margin-bottom:6px;">餐點列表</h4>
          <div style="overflow-x:auto;">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>類別</th>
                  <th>餐點名稱</th>
                  <th>價格</th>
                  <th>預設數量</th>
                  <th>加購</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="edit-menu-table-body"></tbody>
            </table>
          </div>
        </div>

        <button class="btn danger mt-12" id="btn-delete-rest">刪除此店家</button>
      </div>
    </section>

    <!-- 1-4 訂餐紀錄 -->
    <section id="section-orders" class="section">
      <div class="card">
        <h3>1-4 訂餐紀錄</h3>
        <div class="group mt-8" style="max-width:320px;">
          <div>
            <label>訂單日期</label>
            <input type="date" id="order-date" />
          </div>
        </div>
        <div class="mt-8" style="font-size:13px;color:#6b7280;">
          之後會顯示彙整：排骨飯70+蛋10 數量2；排骨飯70 數量1；豬腳飯80+菜30 數量1 …  
          目前先預留版位。
        </div>
      </div>
    </section>

    <!-- 1-5 訂單統計 -->
    <section id="section-stats" class="section">
      <div class="card">
        <h3>1-5 訂單統計</h3>
        <div class="group mt-8" style="max-width:420px;">
          <div>
            <label>訂單日期</label>
            <input type="date" id="stats-date" />
          </div>
          <div>
            <label>統計模式</label>
            <select id="stats-mode">
              <option value="byMeal">依餐點統計</option>
              <option value="byPerson">依人員統計</option>
              <option value="byDept">依部門統計</option>
            </select>
          </div>
        </div>
        <div class="mt-8" style="font-size:13px;color:#6b7280;">
          之後可在這裡顯示各種統計圖表與報表。
        </div>
      </div>
    </section>

    <!-- 1-1 新增人員 -->
    <section id="section-add-staff" class="section">
      <div class="card">
        <h3>1-1 新增人員</h3>
        <div class="group mt-8" style="max-width:520px;">
          <div>
            <label>部門</label>
            <select id="staff-dept">
              <option value="管理部">管理部</option>
              <option value="FAE">FAE</option>
              <option value="TSE">TSE</option>
              <option value="新場">新場</option>
              <option value="倉管">倉管</option>
              <option value="數據分析">數據分析</option>
              <option value="RD">RD</option>
              <option value="線上客服">線上客服</option>
              <option value="維運">維運</option>
            </select>
          </div>

          <!-- 按鈕放在人名右邊 -->
          <div>
            <label>人員名稱</label>
            <div class="flex">
              <input id="staff-name" placeholder="輸入人名" />
              <button class="btn sm" id="btn-add-staff">新增</button>
            </div>
          </div>
        </div>

        <div class="list" id="staff-list"></div>
      </div>
    </section>
  </main>

  <script>
    // 左側選單切換
    const menu = document.getElementById("menu");
    const sections = document.querySelectorAll(".section");
    menu.addEventListener("click", (e) => {
      const li = e.target.closest("li");
      if (!li) return;
      const target = li.dataset.target;
      if (!target) return;

      menu.querySelectorAll("li").forEach(item => item.classList.remove("active"));
      li.classList.add("active");

      sections.forEach(sec => {
        sec.classList.toggle("active", sec.id === target);
      });

      const titleMap = {
        "section-add-staff": "新增人員",
        "section-add-restaurant": "新增餐廳",
        "section-restaurants": "餐廳管理",
        "section-orders": "訂餐紀錄",
        "section-stats": "訂單統計"
      };
      const topTitle = document.querySelector(".topbar h3");
      if (titleMap[target]) topTitle.textContent = titleMap[target];
    });

    // 切換使用者 / 登出（帶確認）
    document.getElementById("switchToUser").addEventListener("click", () => {
      const confirmSwitch = window.confirm("要切換成使用者模式嗎？\n\n按「確定」：切換模式\n按「取消」：直接登出");
      if (confirmSwitch) {
        localStorage.setItem("role", "user");
        window.location.href = "user.html";
      } else {
        localStorage.removeItem("role");
        window.location.href = "index.html";
      }
    });

    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("role");
      window.location.href = "index.html";
    });

    // 暫存資料（之後可以改成 Firebase）
    const restaurants = [];   // {id,name,phone,address,map,note,image}
    const menus = [];         // {id,restaurantId,category,name,price,defaultQty,addons}
    const staffByDept = {};   // dept -> [name,...]
    const categoryHistory = []; // 餐點類別歷史

    // 1-2 新增餐廳
    const restNameInput = document.getElementById("rest-name");
    const restPhoneInput = document.getElementById("rest-phone");
    const restAddressInput = document.getElementById("rest-address");
    const restMapInput = document.getElementById("rest-map");
    const restNoteInput = document.getElementById("rest-note");
    const restImageInput = document.getElementById("rest-image");
    const restListDiv = document.getElementById("restaurant-list");
    const restSelect = document.getElementById("menu-rest-select");

    const restCardsDiv = document.getElementById("restaurant-cards");
    const editPanel = document.getElementById("restaurant-edit-panel");
    const editNameInput = document.getElementById("edit-rest-name");
    const editPhoneInput = document.getElementById("edit-rest-phone");
    const editAddressInput = document.getElementById("edit-rest-address");
    const editMapInput = document.getElementById("edit-rest-map");
    const editNoteInput = document.getElementById("edit-rest-note");
    const editMenuTableBody = document.getElementById("edit-menu-table-body");
    const btnDeleteRest = document.getElementById("btn-delete-rest");
    let editingRestaurantId = null;

    function renderRestaurantsList() {
      restListDiv.innerHTML = "";
      restSelect.innerHTML = '<option value="">請選擇餐廳</option>';

      restaurants.forEach((r, idx) => {
        const row = document.createElement("div");
        row.textContent = `${idx + 1}. ${r.name} / ${r.phone || ""} / ${r.address || ""}`;
        restListDiv.appendChild(row);

        const opt = document.createElement("option");
        opt.value = r.id;
        opt.textContent = r.name;
        restSelect.appendChild(opt);
      });
    }

    function renderRestaurantCards() {
      restCardsDiv.innerHTML = "";
      restaurants.forEach(r => {
        const card = document.createElement("div");
        card.className = "restaurant-card";
        card.dataset.id = r.id;

        const img = document.createElement("img");
        if (r.image) {
          img.src = r.image;
        } else {
          img.alt = "no image";
        }
        card.appendChild(img);

        const nameDiv = document.createElement("div");
        nameDiv.className = "restaurant-card-name";
        nameDiv.textContent = r.name || "未命名餐廳";
        card.appendChild(nameDiv);

        const subDiv = document.createElement("div");
        subDiv.className = "restaurant-card-sub";
        subDiv.textContent = r.address || "";
        card.appendChild(subDiv);

        card.addEventListener("click", () => {
          openEditRestaurant(r.id);
        });

        restCardsDiv.appendChild(card);
      });
    }

    function openEditRestaurant(id) {
      const r = restaurants.find(x => x.id === id);
      if (!r) return;
      editingRestaurantId = id;
      editNameInput.value = r.name || "";
      editPhoneInput.value = r.phone || "";
      editAddressInput.value = r.address || "";
      editMapInput.value = r.map || "";
      editNoteInput.value = r.note || "";
      editPanel.style.display = "block";

      renderEditMenusTable();

      // 自動切到 1-3 選單
      menu.querySelectorAll("li").forEach(li => li.classList.remove("active"));
      const li = Array.from(menu.querySelectorAll("li")).find(li => li.dataset.target === "section-restaurants");
      if (li) li.classList.add("active");
      sections.forEach(sec => {
        sec.classList.toggle("active", sec.id === "section-restaurants");
      });
      document.querySelector(".topbar h3").textContent = "餐廳管理";
    }

    function renderEditMenusTable() {
      editMenuTableBody.innerHTML = "";
      if (!editingRestaurantId) return;
      const list = menus.filter(m => m.restaurantId === editingRestaurantId);
      list.forEach((m, idx) => {
        const tr = document.createElement("tr");
        const addonText = m.addons
          .map(a => `${a.name}${a.free ? "(免費)" : `+${a.price}`}`)
          .join("、") || "無";

        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${m.category || ""}</td>
          <td>${m.name}</td>
          <td>${m.price}</td>
          <td>${m.defaultQty}</td>
          <td style="font-size:12px;color:#6b7280;">${addonText}</td>
          <td><button class="btn secondary sm" data-id="${m.id}">刪除</button></td>
        `;
        editMenuTableBody.appendChild(tr);
      });

      // 綁定刪除餐點按鈕
      editMenuTableBody.querySelectorAll("button[data-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const idx = menus.findIndex(m => m.id === id);
          if (idx !== -1) {
            menus.splice(idx, 1);
            renderMenusForRestaurant(editingRestaurantId);
            renderEditMenusTable();
          }
        });
      });
    }

    document.getElementById("btn-save-rest").addEventListener("click", () => {
      if (!editingRestaurantId) return;
      const r = restaurants.find(x => x.id === editingRestaurantId);
      if (!r) return;
      r.name = editNameInput.value.trim();
      r.phone = editPhoneInput.value.trim();
      r.address = editAddressInput.value.trim();
      r.map = editMapInput.value.trim();
      r.note = editNoteInput.value.trim();
      renderRestaurantsList();
      renderRestaurantCards();
      alert("已儲存餐廳資訊");
    });

    btnDeleteRest.addEventListener("click", () => {
      if (!editingRestaurantId) return;
      const r = restaurants.find(x => x.id === editingRestaurantId);
      if (!r) return;
      const ok = window.confirm(`確定要刪除店家「${r.name}」以及所有餐點嗎？`);
      if (!ok) return;

      // 刪除店家
      const idx = restaurants.findIndex(x => x.id === editingRestaurantId);
      if (idx !== -1) restaurants.splice(idx, 1);

      // 刪除該店所有餐點
      for (let i = menus.length - 1; i >= 0; i--) {
        if (menus[i].restaurantId === editingRestaurantId) {
          menus.splice(i, 1);
        }
      }

      editingRestaurantId = null;
      editPanel.style.display = "none";
      renderRestaurantsList();
      renderRestaurantCards();
      document.getElementById("menu-list").innerHTML = "";
    });

    document.getElementById("btn-add-restaurant").addEventListener("click", () => {
      const name = restNameInput.value.trim();
      if (!name) { alert("請輸入餐廳名稱"); return; }

      const restObj = {
        id: Date.now().toString(),
        name,
        phone: restPhoneInput.value.trim(),
        address: restAddressInput.value.trim(),
        map: restMapInput.value.trim(),
        note: restNoteInput.value.trim(),
        image: null
      };
      restaurants.push(restObj);

      const file = restImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          restObj.image = e.target.result;
          renderRestaurantCards();
        };
        reader.readAsDataURL(file);
      }

      restNameInput.value = "";
      restPhoneInput.value = "";
      restAddressInput.value = "";
      restMapInput.value = "";
      restNoteInput.value = "";
      restImageInput.value = "";

      renderRestaurantsList();
      renderRestaurantCards();
    });

    // 2-2 加購項目欄位
    const addonsContainer = document.getElementById("addons-container");
    const btnAddAddon = document.getElementById("btn-add-addon");

    function createAddonRow() {
      const wrap = document.createElement("div");
      wrap.className = "group mt-8";
      wrap.innerHTML = `
        <div>
          <label>加購名稱</label>
          <input class="addon-name" placeholder="例：加蛋" />
        </div>
        <div>
          <label>加購金額</label>
          <input class="addon-price" type="number" min="0" step="1" value="0" />
        </div>
        <div class="flex">
          <label>
            <input type="checkbox" class="addon-free" />
            免費（勾選後可不用輸入金額）
          </label>
          <button type="button" class="btn secondary sm btn-remove-addon">刪除</button>
        </div>`;
      addonsContainer.appendChild(wrap);
      wrap.querySelector(".btn-remove-addon").addEventListener("click", () => {
        addonsContainer.removeChild(wrap);
      });
    }
    btnAddAddon.addEventListener("click", createAddonRow);
    createAddonRow(); // 預設一列

    // 類別歷史 datalist 更新
    const categoryInput = document.getElementById("menu-category");
    const categoryList = document.getElementById("category-list");

    function updateCategoryDatalist() {
      categoryList.innerHTML = "";
      categoryHistory.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        categoryList.appendChild(opt);
      });
    }

    function addCategoryToHistory(cat) {
      const c = cat.trim();
      if (!c) return;
      if (!categoryHistory.includes(c)) {
        categoryHistory.push(c);
        updateCategoryDatalist();
      }
    }

    // 新增餐點
    const menuListDiv = document.getElementById("menu-list");
    function renderMenusForRestaurant(restId) {
      menuListDiv.innerHTML = "";
      if (!restId) return;
      const list = menus.filter(m => m.restaurantId === restId);
      list.forEach((m, idx) => {
        const div = document.createElement("div");
        const addonText = m.addons
          .map(a => `${a.name}${a.free ? "(免費)" : `+${a.price}`}`)
          .join("、") || "無加購";
        div.innerHTML = `
          ${idx + 1}. [${m.category || ""}] ${m.name} $${m.price}（預設數量：${m.defaultQty}）<br/>
          <span style="font-size:12px;color:#6b7280;">加購：${addonText}</span>`;
        menuListDiv.appendChild(div);
      });
    }

    document.getElementById("btn-add-menu").addEventListener("click", () => {
      const restId = restSelect.value;
      const category = categoryInput.value.trim();
      const name = document.getElementById("menu-name").value.trim();
      const price = Number(document.getElementById("menu-price").value || "0");
      const defaultQty = Number(document.getElementById("menu-default-qty").value || "1");

      if (!restId) { alert("請先選擇餐廳"); return; }
      if (!name) { alert("請輸入餐點名稱"); return; }

      const addonRows = addonsContainer.querySelectorAll(".group");
      const addons = [];
      addonRows.forEach(row => {
        const n = row.querySelector(".addon-name").value.trim();
        const free = row.querySelector(".addon-free").checked;
        let p = Number(row.querySelector(".addon-price").value || "0");
        if (free) p = 0;
        if (n) addons.push({ name: n, price: p, free });
      });

      menus.push({
        id: Date.now().toString(),
        restaurantId: restId,
        category,
        name,
        price,
        defaultQty,
        addons
      });

      // 類別加入歷史
      addCategoryToHistory(category);

      document.getElementById("menu-name").value = "";
      document.getElementById("menu-price").value = "0";
      document.getElementById("menu-default-qty").value = "1";
      categoryInput.value = "";
      addonsContainer.innerHTML = "";
      createAddonRow();

      renderMenusForRestaurant(restId);

      if (editingRestaurantId === restId) {
        renderEditMenusTable();
      }
    });

    document.getElementById("menu-rest-select").addEventListener("change", (e) => {
      renderMenusForRestaurant(e.target.value);
    });

    // 新增人員
    const staffDeptSelect = document.getElementById("staff-dept");
    const staffNameInput = document.getElementById("staff-name");
    const staffListDiv = document.getElementById("staff-list");

    function renderStaff() {
      staffListDiv.innerHTML = "";
      const depts = ["管理部","FAE","TSE","新場","倉管","數據分析","RD","線上客服","維運"];
      depts.forEach(dept => {
        const people = staffByDept[dept] || [];
        const detailsEl = document.createElement("details");
        detailsEl.open = true;
        const summary = document.createElement("summary");
        summary.textContent = `${dept}（${people.length} 人）`;
        detailsEl.appendChild(summary);
        const inner = document.createElement("div");
        people.forEach((name, idx) => {
          const pill = document.createElement("div");
          pill.className = "staff-pill";
          pill.innerHTML = `
            <span>${name}</span>
            <button type="button" data-idx="${idx}" data-dept="${dept}">✕</button>`;
          inner.appendChild(pill);
        });
        detailsEl.appendChild(inner);
        staffListDiv.appendChild(detailsEl);
      });

      staffListDiv.querySelectorAll(".staff-pill button").forEach(btn => {
        btn.addEventListener("click", () => {
          const dept = btn.dataset.dept;
          const idx = Number(btn.dataset.idx);
          staffByDept[dept].splice(idx, 1);
          renderStaff();
        });
      });
    }

    function addStaff() {
      const dept = staffDeptSelect.value;
      const name = staffNameInput.value.trim();
      if (!name) { alert("請輸入人員名稱"); return; }
      if (!staffByDept[dept]) staffByDept[dept] = [];
      staffByDept[dept].push(name);
      staffNameInput.value = "";
      renderStaff();
    }

    document.getElementById("btn-add-staff").addEventListener("click", addStaff);
    // 按 Enter 也能新增人員
    staffNameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        addStaff();
      }
    });

    renderStaff();

    // 簡單身分驗證
    (function checkRole() {
      const role = localStorage.getItem("role");
      if (role !== "admin") {
        window.location.href = "index.html";
      }
    })();
  </script>
</body>
</html>
