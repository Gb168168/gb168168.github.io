<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoldBricks — 管理後台</title>
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #0b1220;
      --panel: #111827;
      --border: #1f2937;
      --accent: #3b82f6;
      --accent2: #1d4ed8;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: #020617;
      color: var(--text);
    }

    /* 上方列：漢堡 + GoldBricks + 搜尋欄 */
    .top-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      background: #020617;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .menu-btn{
      border-radius:999px;
      border:1px solid var(--border);
      padding:6px 10px;
      background:transparent;
      color:var(--text);
      font-size:18px;
    }
    .logo{
      font-size:20px;
      font-weight:700;
      flex-shrink:0;
    }
    .search-input{ flex:1; }
    .search-input input{
      width:100%;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#020617;
      color:var(--text);
      font-size:14px;
    }
    .search-input input::placeholder{ color:var(--text-soft); }

    /* 版面 */
    .layout{ display:flex; min-height:calc(100vh - 44px); }
    .side{
      width:220px;
      background:var(--panel);
      border-right:1px solid var(--border);
      padding:14px 10px;
    }
    .side-title{
      font-size:13px;
      color:var(--text-soft);
      margin:0 0 8px 6px;
      text-transform:uppercase;
    }
    .menu-list{ list-style:none; padding:0; margin:0; }
    .menu-list li{ margin-bottom:4px; }
    .menu-list button{
      width:100%;
      text-align:left;
      padding:8px 10px;
      border-radius:10px;
      border:none;
      background:transparent;
      color:var(--text-soft);
      font-size:14px;
    }
    .menu-list button.active,
    .menu-list button:hover{
      background:rgba(59,130,246,0.2);
      color:var(--text);
    }

    @media(max-width:768px){
      .layout{ flex-direction:column; }
      .side{
        position:fixed;
        top:44px;
        left:-240px;
        height:calc(100vh - 44px);
        z-index:20;
        transition:left .2s;
      }
      .side.open{ left:0; }
    }

    .content{
      flex:1;
      padding:14px 14px 40px;
      background:#020617;
    }
    .section{
      background:var(--bg-soft);
      border-radius:14px;
      padding:14px 14px 18px;
      border:1px solid var(--border);
      margin-bottom:14px;
    }
    .section-header{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      margin-bottom:8px;
    }
    .section-title{
      font-size:16px;
      font-weight:600;
    }
    .section-sub{
      font-size:12px;
      color:var(--text-soft);
    }
    .tag{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(148,163,184,0.2);
      margin-left:6px;
      color:var(--text-soft);
    }
    .two-col{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:10px;
    }
    label{
      font-size:13px;
      color:var(--text-soft);
      display:block;
      margin-bottom:3px;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea,
    select{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#020617;
      color:var(--text);
      font-size:14px;
    }
    textarea{ min-height:60px; resize:vertical; }
    input::placeholder,textarea::placeholder{ color:var(--text-soft); }
    .field{ margin-bottom:10px; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 14px;
      border-radius:999px;
      border:none;
      font-size:14px;
      cursor:pointer;
      margin-top:4px;
    }
    .btn-primary{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#fff;
    }
    .btn-outline{
      background:transparent;
      border:1px solid var(--border);
      color:var(--text-soft);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      padding:3px 8px;
      border-radius:999px;
      background:#020617;
      border:1px solid var(--border);
      font-size:12px;
      margin:2px 4px 0 0;
    }

    /* 餐廳列表 */
    .restaurant-list{
      margin-top:6px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
      gap:8px;
    }
    .rest-card{
      display:flex;
      gap:8px;
      padding:8px;
      background:#020617;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:12px;
    }
    .rest-thumb{
      width:60px;
      height:60px;
      border-radius:10px;
      background:#0f172a;
      object-fit:cover;
      flex-shrink:0;
    }
    .rest-name{
      font-size:14px;
      font-weight:600;
      margin-bottom:2px;
    }
    .btn-mini{
      padding:3px 6px;
      font-size:11px;
      border-radius:999px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text-soft);
      margin-top:2px;
    }

    /* 餐點列表 */
    table{ width:100%; border-collapse:collapse; font-size:12px; }
    th,td{ padding:4px 4px; border-bottom:1px solid var(--border); text-align:left; }
    th{ color:var(--text-soft); font-weight:500; }
    .text-right{text-align:right;}

    /* 加購項目 */
    .addon-row{
      display:grid;
      grid-template-columns:1.4fr 0.8fr auto;
      gap:6px;
      margin-bottom:6px;
      align-items:center;
    }
    .addon-row small{
      font-size:11px;
      color:var(--text-soft);
    }

    .danger{ color:var(--danger); }
  </style>
</head>
<body>

  <!-- 上方：漢堡 + GoldBricks + 搜尋餐廳 -->
  <div class="top-bar">
    <button class="menu-btn" id="menuToggle">≡</button>
    <div class="logo">GoldBricks</div>
    <div class="search-input">
      <input id="globalSearch" type="text" placeholder="輸入餐廳名稱查詢…">
    </div>
  </div>

  <div class="layout">
    <!-- 側邊選單 -->
    <aside class="side" id="sideMenu">
      <p class="side-title">後台管理</p>
      <ul class="menu-list">
        <li><button data-target="staffSec">新增人員</button></li>
        <li><button data-target="restSec" class="active">餐廳管理</button></li>
        <li><button data-target="menuSec">餐點管理</button></li>
        <li><button data-target="statSec">訂單統計</button></li>
        <li><button data-target="orderSec">訂單管理</button></li>
      </ul>
    </aside>

    <!-- 主要內容 -->
    <main class="content">

      <!-- 新增人員 -->
      <section class="section" id="staffSec">
        <div class="section-header">
          <div>
            <span class="section-title">新增人員</span>
            <span class="tag">部門 / 人員</span>
          </div>
          <div class="section-sub">供使用者登入點餐時選擇</div>
        </div>
        <div class="two-col">
          <div>
            <div class="field">
              <label>部門名稱</label>
              <input id="deptInput" type="text" placeholder="例如：銷售一部">
            </div>
            <div class="field">
              <label>人員姓名</label>
              <input id="staffInput" type="text" placeholder="例如：王小明">
            </div>
            <button class="btn btn-primary" id="addStaffBtn">新增人員</button>
          </div>
          <div>
            <label>已建立部門 / 人員</label>
            <div id="staffList"></div>
          </div>
        </div>
      </section>

      <!-- 餐廳管理 -->
      <section class="section" id="restSec">
        <div class="section-header">
          <div>
            <span class="section-title">餐廳管理</span>
            <span class="tag">新增餐廳</span>
          </div>
          <div class="section-sub">餐廳名稱、電話、地址、備註、Google Map、圖片上傳</div>
        </div>
        <div class="two-col">
          <div>
            <div class="field">
              <label>餐廳名稱</label>
              <input id="restName" type="text" placeholder="例如：鴨門現炒（必填）">
            </div>
            <div class="field">
              <label>電話</label>
              <input id="restPhone" type="text" placeholder="02-1234-5678">
            </div>
            <div class="field">
              <label>地址</label>
              <input id="restAddr" type="text" placeholder="餐廳地址">
            </div>
            <div class="field">
              <label>備註</label>
              <textarea id="restNote" placeholder="例如：只收現金、可加飯、不吃辣請備註"></textarea>
            </div>
            <div class="field">
              <label>Google Map 連結</label>
              <input id="restMap" type="text" placeholder="貼上地圖網址">
            </div>
            <div class="field">
              <label>餐廳圖片上傳</label>
              <input id="restImg" type="file" accept="image/*">
            </div>
            <button class="btn btn-primary" id="addRestBtn">新增餐廳</button>
          </div>

          <div>
            <label>已新增餐廳</label>
            <div class="restaurant-list" id="restList"></div>
          </div>
        </div>
      </section>

      <!-- 餐點管理 -->
      <section class="section" id="menuSec">
        <div class="section-header">
          <div>
            <span class="section-title">餐點管理</span>
            <span class="tag">類別 / 價格 / 加購</span>
          </div>
          <div class="section-sub">可勾選加購項目，並設定是否需付款</div>
        </div>
        <div class="two-col">
          <div>
            <div class="field">
              <label>餐廳名稱</label>
              <select id="menuRestSelect">
                <option value="">請先在「餐廳管理」新增餐廳</option>
              </select>
            </div>
            <div class="field">
              <label>餐點類別</label>
              <input id="menuCat" type="text" placeholder="飯類 / 麵類 / 小菜 / 飲料">
            </div>
            <div class="field">
              <label>餐點名稱</label>
              <input id="menuName" type="text" placeholder="例如：排骨飯">
            </div>
            <div class="field">
              <label>價格（單份）</label>
              <input id="menuPrice" type="number" min="0" placeholder="例如：70">
            </div>
            <div class="field">
              <label>預設數量</label>
              <input id="menuQty" type="number" min="1" value="1">
            </div>

            <div class="field">
              <label>加購項目（自行輸入，可選擇是否需付款）</label>
              <div id="addonBox"></div>
              <button type="button" class="btn btn-outline" id="addAddonBtn">＋ 新增加購項目</button>
            </div>

            <button class="btn btn-primary" id="addMenuBtn">新增餐點</button>
          </div>

          <div>
            <label>餐點列表</label>
            <div style="max-height:260px;overflow:auto;margin-top:4px;">
              <table>
                <thead>
                  <tr>
                    <th>餐廳</th>
                    <th>類別</th>
                    <th>名稱</th>
                    <th class="text-right">價格</th>
                    <th class="text-right">數量</th>
                    <th>加購</th>
                  </tr>
                </thead>
                <tbody id="menuTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- 訂單統計 -->
      <section class="section" id="statSec">
        <div class="section-header">
          <div>
            <span class="section-title">訂單統計</span>
            <span class="tag">日期 + 模式</span>
          </div>
          <div class="section-sub">起始日 / 結束日，模式：店家 / 部門 / 人員</div>
        </div>
        <div class="two-col">
          <div>
            <div class="field">
              <label>起始日</label>
              <input id="statStart" type="date">
            </div>
            <div class="field">
              <label>結束日</label>
              <input id="statEnd" type="date">
            </div>
            <div class="field">
              <label>統計模式</label>
              <select id="statMode">
                <option value="store">店家</option>
                <option value="dept">部門</option>
                <option value="staff">人員</option>
              </select>
            </div>
            <button class="btn btn-primary">產生統計（之後串訂單）</button>
          </div>
          <div>
            <label>統計結果</label>
            <p class="section-sub">
              之後會依訂單資料顯示各餐廳 / 部門 / 人員的統計金額與份數。
            </p>
          </div>
        </div>
      </section>

      <!-- 訂單管理 -->
      <section class="section" id="orderSec">
        <div class="section-header">
          <div>
            <span class="section-title">訂單管理</span>
            <span class="tag">彙整相同餐點</span>
          </div>
          <div class="section-sub">
            相同餐點名稱排序在一起，顯示部門 / 名字 / 餐點 / 總金額，預算 140 超過顯示紅字。
          </div>
        </div>
        <p class="section-sub">
          這裡暫時是版面預留，等使用者點餐頁完成後會在這裡彙整，例如：<br>
          A 排骨飯70+蛋10<br>
          B 排骨飯70<br>
          C 排骨飯70+蛋10<br>
          D 豬腳飯80+菜30<br><br>
          彙整為：<br>
          排骨飯70+蛋10 數量2<br>
          排骨飯70 數量1<br>
          豬腳飯80+菜30 數量1
        </p>
      </section>

    </main>
  </div>

  <script>
    // 簡單記在記憶體，重新整理就會清空（Github Pages 純前端 demo）
    const staffData = [];
    const restaurants = [];
    const menuItems = [];

    /* 漢堡選單（手機） */
    const menuToggle = document.getElementById('menuToggle');
    const sideMenu   = document.getElementById('sideMenu');
    menuToggle.addEventListener('click', () => {
      sideMenu.classList.toggle('open');
    });

    /* 側邊選單 → 捲動到區塊 */
    document.querySelectorAll('.menu-list button').forEach(btn=>{
      btn.onclick = () => {
        document.querySelectorAll('.menu-list button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const id = btn.dataset.target;
        const sec = document.getElementById(id);
        if(sec) sec.scrollIntoView({behavior:'smooth',block:'start'});
        sideMenu.classList.remove('open');
      };
    });

    /* 新增人員 */
    const deptInput  = document.getElementById('deptInput');
    const staffInput = document.getElementById('staffInput');
    const staffList  = document.getElementById('staffList');
    document.getElementById('addStaffBtn').onclick = () => {
      const dept  = deptInput.value.trim();
      const staff = staffInput.value.trim();
      if(!dept || !staff){ alert('請輸入部門與人員姓名'); return; }
      staffData.push({dept,staff});
      deptInput.value = '';
      staffInput.value = '';
      renderStaff();
    };
    function renderStaff(){
      staffList.innerHTML = '';
      staffData.forEach(s=>{
        const el = document.createElement('div');
        el.className = 'pill';
        el.textContent = `${s.dept} - ${s.staff}`;
        staffList.appendChild(el);
      });
    }

    /* 新增餐廳 */
    const restName = document.getElementById('restName');
    const restPhone= document.getElementById('restPhone');
    const restAddr = document.getElementById('restAddr');
    const restNote = document.getElementById('restNote');
    const restMap  = document.getElementById('restMap');
    const restImg  = document.getElementById('restImg');
    const restList = document.getElementById('restList');
    const menuRestSelect = document.getElementById('menuRestSelect');

    document.getElementById('addRestBtn').onclick = () => {
      const name = restName.value.trim();
      if(!name){ alert('餐廳名稱為必填'); return; }

      const data = {
        id: Date.now(),
        name,
        phone: restPhone.value.trim(),
        addr : restAddr.value.trim(),
        note : restNote.value.trim(),
        map  : restMap.value.trim(),
        img  : null
      };

      const file = restImg.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = e=>{
          data.img = e.target.result;
          pushRestaurant(data);
        };
        reader.readAsDataURL(file);
      }else{
        pushRestaurant(data);
      }
    };

    function pushRestaurant(data){
      restaurants.push(data);
      restName.value='';restPhone.value='';restAddr.value='';
      restNote.value='';restMap.value='';restImg.value='';
      renderRestaurants();
      syncRestaurantSelect();
    }

    function renderRestaurants(){
      restList.innerHTML = '';
      restaurants.forEach((r,idx)=>{
        const card = document.createElement('div');
        card.className = 'rest-card';

        const img = document.createElement('img');
        img.className = 'rest-thumb';
        if(r.img) img.src = r.img; else img.alt = 'no image';

        const info = document.createElement('div');
        info.style.flex = '1';
        info.innerHTML = `
          <div class="rest-name">${r.name}</div>
          <div>${r.phone || ''}</div>
          <div>${r.addr || ''}</div>
          <div class="section-sub" style="margin-top:2px;">${r.note || ''}</div>
        `;

        const btns = document.createElement('div');
        const up = document.createElement('button');
        up.className='btn-mini'; up.textContent='上移';
        up.onclick = ()=>moveRestaurant(idx,-1);
        const down = document.createElement('button');
        down.className='btn-mini'; down.textContent='下移';
        down.onclick = ()=>moveRestaurant(idx,1);
        btns.appendChild(up); btns.appendChild(down);

        card.appendChild(img);
        card.appendChild(info);
        card.appendChild(btns);
        restList.appendChild(card);
      });
    }

    function moveRestaurant(i,dir){
      const j = i+dir;
      if(j<0 || j>=restaurants.length) return;
      const t = restaurants[i];
      restaurants[i] = restaurants[j];
      restaurants[j] = t;
      renderRestaurants();
      syncRestaurantSelect();
    }

    function syncRestaurantSelect(){
      menuRestSelect.innerHTML = '';
      if(!restaurants.length){
        const op = document.createElement('option');
        op.value=''; op.textContent='請先在「餐廳管理」新增餐廳';
        menuRestSelect.appendChild(op);
        return;
      }
      restaurants.forEach(r=>{
        const op = document.createElement('option');
        op.value = r.id;
        op.textContent = r.name;
        menuRestSelect.appendChild(op);
      });
    }

    /* 上方搜尋：暫時讓包含關鍵字的餐廳名字變藍 */
    document.getElementById('globalSearch').addEventListener('input',e=>{
      const key = e.target.value.trim().toLowerCase();
      document.querySelectorAll('.rest-name').forEach(el=>{
        const txt = el.textContent.toLowerCase();
        el.style.color = key && txt.includes(key) ? '#38bdf8' : '#e5e7eb';
      });
    });

    /* 加購項目 */
    const addonBox = document.getElementById('addonBox');
    document.getElementById('addAddonBtn').onclick = addAddonRow;
    function addAddonRow(){
      const row = document.createElement('div');
      row.className = 'addon-row';
      const name = document.createElement('input');
      name.type='text'; name.placeholder='加購名稱（蛋 / 加麵）';
      const price = document.createElement('input');
      price.type='number'; price.min='0'; price.placeholder='加價金額';
      const right = document.createElement('div');
      right.innerHTML = `
        <label style="font-size:11px;color:var(--text-soft);display:flex;align-items:center;gap:4px;">
          <input type="checkbox" class="addon-free"> 免費
        </label>
        <button type="button" class="btn-mini">刪除</button>
      `;
      const freeChk = right.querySelector('.addon-free');
      freeChk.onchange = ()=>{
        if(freeChk.checked){ price.value=''; price.disabled=true; }
        else{ price.disabled=false; }
      };
      right.querySelector('button').onclick = ()=> row.remove();
      row.appendChild(name);
      row.appendChild(price);
      row.appendChild(right);
      addonBox.appendChild(row);
    }
    addAddonRow(); // 先給一列

    /* 新增餐點 */
    const menuTableBody = document.getElementById('menuTableBody');
    document.getElementById('addMenuBtn').onclick = ()=>{
      const restId = menuRestSelect.value;
      if(!restId){ alert('請先選擇餐廳'); return; }
      const rest = restaurants.find(r=>r.id==restId);
      const cat  = document.getElementById('menuCat').value.trim();
      const name = document.getElementById('menuName').value.trim();
      const price= Number(document.getElementById('menuPrice').value);
      const qty  = Number(document.getElementById('menuQty').value || 1);
      if(!name || isNaN(price)){ alert('請填寫餐點名稱與價格'); return; }

      const addons = [];
      addonBox.querySelectorAll('.addon-row').forEach(row=>{
        const inputs = row.querySelectorAll('input');
        const aName = inputs[0].value.trim();
        const aPrice= Number(inputs[1].value || 0);
        const aFree = row.querySelector('.addon-free').checked;
        if(!aName) return;
        addons.push({name:aName, price:aFree?0:aPrice, free:aFree});
      });

      menuItems.push({
        restId,
        restName: rest?rest.name:'',
        cat,
        name,
        price,
        qty,
        addons
      });

      renderMenuTable();

      // 清空輸入（保留餐廳）
      document.getElementById('menuCat').value='';
      document.getElementById('menuName').value='';
      document.getElementById('menuPrice').value='';
      document.getElementById('menuQty').value='1';
      addonBox.innerHTML='';
      addAddonRow();
    };

    function renderMenuTable(){
      menuTableBody.innerHTML='';
      menuItems.forEach(item=>{
        const tr = document.createElement('tr');
        const addonText = item.addons.map(a=>{
          if(a.free) return `${a.name}(免費)`;
          return `${a.name}+${a.price}`;
        }).join('、');
        tr.innerHTML = `
          <td>${item.restName}</td>
          <td>${item.cat || '-'}</td>
          <td>${item.name}</td>
          <td class="text-right">${item.price}</td>
          <td class="text-right">${item.qty}</td>
          <td>${addonText || '-'}</td>
        `;
        menuTableBody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
