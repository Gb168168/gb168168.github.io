<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GoldBricks å‘·å¥”ğŸ‘½ï½œç®¡ç†è€…</title>

  <!-- SortableJS -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

  <!-- Excelï¼ˆSheetJSï¼‰-->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
    /* ğŸ¨ ç¬¬ 2 å‰µå»ºï¼šCSS æš—è‰²æœƒåœ¨ä¸‹ä¸€å‰‡è¨Šæ¯è£œé½Š */
  </style>
</head>

<body>

  <!-- ====================== -->
  <!-- ğŸŸ¦ Sidebar å´æ¬„ -->
  <!-- ====================== -->
  <aside id="sidebar">
    <div class="logo">GoldBricks å‘·å¥”ğŸ‘½ï½œç®¡ç†è€…</div>
    <nav>
      <button data-target="view_restaurants">é¤å»³ç®¡ç†</button>
      <button data-target="view_menu">é¤é»ç®¡ç†</button>
      <button data-target="view_staff">äººå“¡æ¸…å–®</button>
      <button data-target="view_orders">è¨‚å–®ç´€éŒ„</button>
      <button data-target="view_stats">è¨‚å–®çµ±è¨ˆ</button>
    </nav>
  </aside>

  <!-- ====================== -->
  <!-- ğŸŸ© Main ä¸»å…§å®¹ -->
  <!-- ====================== -->
  <main id="main">

    <!-- =========================== -->
    <!-- ğŸ“Œ 1. é¤å»³ç®¡ç† -->
    <!-- =========================== -->
    <section id="view_restaurants" class="page">
      <h2>é¤å»³ç®¡ç†</h2>

      <!-- ğŸ” é¤å»³æœå°‹ -->
      <input id="search_restaurant" placeholder="æœå°‹é¤å»³â€¦" />

      <!-- â• æ–°å¢é¤å»³æŒ‰éˆ• -->
      <button id="btnAddRestaurant" class="primary">æ–°å¢é¤å»³</button>

      <!-- é¤å»³åˆ—è¡¨ -->
      <div id="restaurantList"></div>
    </section>

    <!-- =========================== -->
    <!-- ğŸ“Œ 2. é¤é»ç®¡ç† -->
    <!-- =========================== -->
    <section id="view_menu" class="page">
      <h2>é¤é»ç®¡ç†</h2>

      <!-- ğŸ” é¤é»æœå°‹ -->
      <input id="search_menu" placeholder="æœå°‹é¤é»â€¦" />

      <!-- â• æ–°å¢é¤é»ï¼ˆæœƒå«å®Œæ•´é¸é …ç¾¤çµ„æ¨¡çµ„ï¼‰ -->
      <button id="btnAddDish" class="primary">æ–°å¢é¤é»</button>

      <!-- é¤é»åˆ—è¡¨ -->
      <div id="menuList"></div>
    </section>

    <!-- =========================== -->
    <!-- ğŸ“Œ 3. äººå“¡ç®¡ç† -->
    <!-- =========================== -->
    <section id="view_staff" class="page">
      <h2>äººå“¡æ¸…å–®</h2>

      <!-- æ–°å¢äººå“¡ -->
      <button id="btnAddStaff" class="primary">æ–°å¢äººå“¡</button>

      <!-- éƒ¨é–€æ’åºæ‹–æ›³å®¹å™¨ -->
      <div id="staffDeptList"></div>
    </section>

    <!-- =========================== -->
    <!-- ğŸ“Œ 4. è¨‚å–®ç´€éŒ„ -->
    <!-- =========================== -->
    <section id="view_orders" class="page">
      <h2>è¨‚å–®ç´€éŒ„ï¼ˆå½™æ•´è¼¸å‡ºï¼‰</h2>

      <!-- æ—¥æœŸé¸æ“‡ -->
      <input type="date" id="o_date" />

      <!-- è¼‰å…¥è¨‚å–®æŒ‰éˆ• -->
      <button id="btnLoadOrders" class="primary">è¼‰å…¥è¨‚å–®</button>

      <!-- è¨‚å–®å½™æ•´ -->
      <div id="orderList"></div>
    </section>

    <!-- =========================== -->
    <!-- ğŸ“Œ 5. è¨‚å–®çµ±è¨ˆ -->
    <!-- =========================== -->
    <section id="view_stats" class="page">
      <h2>è¨‚å–®çµ±è¨ˆ</h2>

      <!-- æ—¥æœŸé¸æ“‡ -->
      <input type="date" id="s_date" />

      <!-- è¼‰å…¥çµ±è¨ˆ -->
      <button id="btnLoadStats" class="primary">è¼‰å…¥çµ±è¨ˆ</button>

      <!-- çµ±è¨ˆè¡¨æ ¼ -->
      <div id="statsTable"></div>
    </section>

  </main>

  <!-- ====================== -->
  <!-- ğŸŸ§ å³å´å½ˆå‡ºè¦–çª—ï¼ˆæ–°å¢é¤å»³ / é¤é»ï¼‰ -->
  <!-- ====================== -->
  <div id="drawer">
    <div id="drawerContent">
      <!-- é€™è£¡æ˜¯å‹•æ…‹å¡«å…§å®¹ï¼ˆæ–°å¢é¤å»³è¡¨å–® / æ–°å¢é¤é»è¡¨å–®ï¼‰ -->
    </div>
  </div>

  <!-- JSï¼ˆä¸‹ä¸€æ®µè£œä¸ŠåŠŸèƒ½ç‰ˆï¼‰ -->
  <script>
    // ğŸ§© ç¬¬ 3 éƒ¨åˆ†ï¼šJS å…¨åŠŸèƒ½å°‡åœ¨ä¸‹ä¸€å‰‡è¨Šæ¯ç”Ÿæˆ
  </script>

</body>

</html>
<style>
/* =========================================================
   ğŸ¨ æš—è‰²ç³»ä¸»é¡Œï¼ˆC3ï¼šæ·±ç° + æŸ”ç²‰ Aï¼‰
   ========================================================= */
:root{
  --bg:#1e1e1e;
  --card:#2b2b2b;
  --text:#f3f4f6;
  --muted:#a1a1aa;

  --primary:#fb7185;
  --primary-light:#fda4af;

  --border:rgba(255,255,255,.08);
  --border2:rgba(255,255,255,.15);

  --shadow:0 10px 30px rgba(0,0,0,.55);
  --radius:18px;
}

*{
  box-sizing:border-box;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* =========================================================
   ğŸŸ¦ Sidebar å´æ¬„
   ========================================================= */
#sidebar{
  width:240px;
  background:#151515;
  color:var(--text);
  padding:24px 20px;
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
}

#sidebar .logo{
  font-size:18px;
  font-weight:700;
  margin-bottom:24px;
  color:var(--primary);
}

#sidebar nav button{
  width:100%;
  padding:12px 10px;
  margin-bottom:8px;
  border-radius:10px;
  border:1px solid transparent;
  background:#222;
  color:var(--text);
  text-align:left;
  cursor:pointer;
  transition:.2s;
}

#sidebar nav button:hover{
  background:#333;
  border-color:var(--border2);
}

#sidebar nav button.active{
  background:var(--primary);
  color:#1e1e1e;
  font-weight:700;
}

/* =========================================================
   ğŸŸ© Main ä¸»å…§å®¹
   ========================================================= */
#main{
  flex:1;
  overflow-y:auto;
  padding:30px;
}

h2{
  margin:0 0 20px;
  font-size:24px;
  font-weight:600;
  letter-spacing:.5px;
}

/* =========================================================
   ğŸŸ« æ•´é«”å…ƒä»¶ï¼šinput / select / button / card
   ========================================================= */
input, select, textarea{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid var(--border2);
  background:#262626;
  color:var(--text);
  margin-bottom:12px;
  font-size:15px;
}

input::placeholder{
  color:#777;
}

button{
  padding:10px 20px;
  border-radius:12px;
  border:none;
  font-size:15px;
  cursor:pointer;
  transition:.2s;
}

button.primary{
  background:var(--primary);
  color:#1e1e1e;
  font-weight:700;
}

button.primary:hover{
  background:var(--primary-light);
}

button.secondary{
  background:#333;
  color:var(--text);
  border:1px solid var(--border2);
}

button.secondary:hover{
  background:#444;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  border:1px solid var(--border);
  margin-bottom:18px;
}

/* =========================================================
   ğŸ—‚ï¸ å¤šå±¤åˆ—è¡¨ / æŠ˜ç–Š details
   ========================================================= */
details{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  margin-bottom:14px;
}

details summary{
  cursor:pointer;
  font-size:16px;
  font-weight:600;
  color:var(--primary);
}

/* =========================================================
   ğŸ§¾ è¡¨æ ¼ Table
   ========================================================= */
table{
  width:100%;
  border-collapse:collapse;
  background:var(--card);
  border-radius:var(--radius);
  overflow:hidden;
}

table th{
  background:#383838;
  color:var(--primary-light);
  padding:12px 10px;
  text-align:left;
  border-bottom:1px solid var(--border2);
}

table td{
  padding:12px 10px;
  border-bottom:1px solid var(--border);
  color:var(--text);
}

table tr:hover td{
  background:#333;
}

/* =========================================================
   ğŸ›ï¸ Drawer å³å´æŠ½å±œï¼ˆæ–°å¢é¤å»³ / é¤é»ï¼‰
   ========================================================= */
#drawer{
  position:fixed;
  top:0;
  right:-420px;
  width:420px;
  height:100%;
  background:var(--card);
  box-shadow:var(--shadow);
  transition:.3s;
  z-index:50;
  padding:22px;
  border-left:1px solid var(--border2);
  overflow-y:auto;
}

#drawer.open{
  right:0;
}

#drawer h3{
  margin-top:0;
  margin-bottom:16px;
  color:var(--primary-light);
}

/* =========================================================
   ğŸ“Œ é¸é …ç¾¤çµ„å€å¡Šï¼ˆæ–°å¢é¤é»ï¼‰
   ========================================================= */
.option-group{
  background:#262626;
  padding:16px;
  border-radius:14px;
  border:1px solid var(--border2);
  margin-bottom:14px;
}

.option-group-title{
  color:var(--primary-light);
  font-weight:600;
  margin-bottom:10px;
}

.option-item{
  display:flex;
  gap:10px;
  margin-bottom:10px;
}

.option-item input{
  flex:1;
}

.delete-btn{
  background:#3b3b3b;
  color:#f87171;
  border:1px solid #f87171;
}

.delete-btn:hover{
  background:#4b4b4b;
}

/* =========================================================
   ğŸš Scrollbar
   ========================================================= */
::-webkit-scrollbar{
  width:8px;
}
::-webkit-scrollbar-thumb{
  background:#555;
  border-radius:4px;
}
::-webkit-scrollbar-thumb:hover{
  background:#777;
}
</style>
<script>
// ======================================================
//  Firebase åˆå§‹åŒ–ï¼ˆæ²¿ç”¨ä½ åŸæœ¬è¨­å®šï¼‰
// ======================================================
const firebaseConfig = {
  apiKey: "AIzaSyDXoVzD-----ä½ çš„è¨­å®š------",
  authDomain: "goldbricks---",
  projectId: "goldbricks---",
  storageBucket: "goldbricks---",
  messagingSenderId: "---",
  appId: "1:---"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ======================================================
//  é é¢åˆ‡æ›ï¼ˆSidebarï¼‰
// ======================================================
const pages = document.querySelectorAll(".page");
const navBtns = document.querySelectorAll("#sidebar nav button");

navBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    navBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    const target = btn.dataset.target;
    pages.forEach(p=>p.style.display="none");
    document.getElementById(target).style.display="block";
  });
});

// é è¨­é¡¯ç¤ºé¤å»³ç®¡ç†
document.querySelector('#sidebar nav button').click();


// ======================================================
//  Drawerï¼ˆå³å´æŠ½å±œï¼‰
// ======================================================
const drawer = document.getElementById("drawer");
const drawerContent = document.getElementById("drawerContent");

function openDrawer(html){
  drawerContent.innerHTML = html;
  drawer.classList.add("open");
}

function closeDrawer(){
  drawer.classList.remove("open");
}

// å…¨åŸŸï¼šé¸é …ç¾¤çµ„æš«å­˜
let currentGroups = [];


// ======================================================
//  â­ é¸é …ç¾¤çµ„æ¨¡çµ„ï¼ˆæ ¸å¿ƒï¼‰
// ======================================================

// å»ºä¸€å€‹æ–°çš„ç¾¤çµ„
function createOptionGroup(){
  return {
    id: "group_"+Date.now(),
    name: "",
    type: "single",     // single = æ“‡ä¸€ ï¼ multi = åŠ è³¼
    required: false,    // å¿…é¸ï¼ˆåƒ… single æ™‚å¯ç”¨ï¼‰
    options: []         // {name, price}
  };
}


// æ¸²æŸ“æ‰€æœ‰ç¾¤çµ„ UI
function renderGroups(){
  const box = document.getElementById("dishGroupsBox");
  if(!box) return;

  box.innerHTML = "";

  currentGroups.forEach(group=>{
    const div = document.createElement("div");
    div.className = "option-group";
    div.innerHTML = `
      <div class="option-group-title">é¸é …ç¾¤çµ„</div>

      <label>ç¾¤çµ„åç¨±</label>
      <input data-id="${group.id}" data-field="name" value="${group.name}" placeholder="ä¾‹å¦‚ï¼šè¾£åº¦ / é£²æ–™åŠ è³¼" />

      <label>ç¾¤çµ„é¡å‹</label>
      <select data-id="${group.id}" data-field="type">
        <option value="single" ${group.type==="single"?"selected":""}>æ“‡ä¸€ï¼ˆsingleï¼‰</option>
        <option value="multi"  ${group.type==="multi"?"selected":""}>åŠ è³¼ï¼ˆmultiï¼‰</option>
      </select>

      <label>
        <input type="checkbox" data-id="${group.id}" data-field="required" ${group.required?"checked":""} />
        å¿…é¸ï¼ˆåƒ…æ“‡ä¸€å¯ç”¨ï¼‰
      </label>

      <div class="option-group-title" style="margin-top:10px">æ­¤ç¾¤çµ„çš„é¸é …</div>
      <div id="opt_${group.id}">
        ${group.options.map((opt,i)=>`
          <div class="option-item">
            <input data-id="${group.id}" data-opt-index="${i}" data-opt-field="name" value="${opt.name}" placeholder="é¸é …åç¨±">
            <input data-id="${group.id}" data-opt-index="${i}" data-opt-field="price" value="${opt.price}" type="number" placeholder="+å¤šå°‘å…ƒ">
            <button data-id="${group.id}" data-opt-index="${i}" class="delete-btn">åˆª</button>
          </div>
        `).join("")}
      </div>

      <button class="secondary" data-add-option="${group.id}">æ–°å¢é¸é …</button>

      <button class="delete-btn" data-del-group="${group.id}" style="margin-top:10px">åˆªé™¤æ­¤ç¾¤çµ„</button>
    `;
    box.appendChild(div);
  });

  attachGroupEvents();
}


// ç¶å®šç¾¤çµ„å…§æ‰€æœ‰æŒ‰éˆ•äº‹ä»¶
function attachGroupEvents(){
  // ç¾¤çµ„æ¬„ä½è®Šæ›´
  document.querySelectorAll("[data-field]").forEach(input=>{
    input.oninput = ()=>{
      const id = input.dataset.id;
      const field = input.dataset.field;
      const g = currentGroups.find(x=>x.id===id);

      if(input.type==="checkbox"){
        g[field] = input.checked;
      }else{
        g[field] = input.value;
      }
    };
  });

  // æ–°å¢é¸é …
  document.querySelectorAll("[data-add-option]").forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.dataset.addOption;
      const g = currentGroups.find(x=>x.id===id);
      g.options.push({name:"", price:0});
      renderGroups();
    };
  });

  // åˆªé¸é …
  document.querySelectorAll(".delete-btn[data-opt-index]").forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.dataset.id;
      const idx = btn.dataset.optIndex;
      const g = currentGroups.find(x=>x.id===id);
      g.options.splice(idx,1);
      renderGroups();
    };
  });

  // åˆªæ•´å€‹ç¾¤çµ„
  document.querySelectorAll("[data-del-group]").forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.dataset.delGroup;
      currentGroups = currentGroups.filter(x=>x.id!==id);
      renderGroups();
    };
  });
}


// æ–°å¢ä¸€å€‹ç¾¤çµ„ï¼ˆå¤–éƒ¨å‘¼å«ï¼‰
function addGroup(){
  currentGroups.push(createOptionGroup());
  renderGroups();
}


// ======================================================
//  â­ å°ˆç”¨ï¼šç”Ÿæˆã€Œæ–°å¢é¤é»ã€è¡¨å–®ï¼ˆå«ç¾¤çµ„æ¨¡çµ„ï¼‰
// ======================================================
function showAddDishForm(restId=null){
  currentGroups = []; // æ¸…ç©º

  openDrawer(`
    <h3>æ–°å¢é¤é»</h3>

    <label>é¤é»åç¨±</label>
    <input id="d_name" placeholder="åç¨±">

    <label>åˆ†é¡ï¼ˆå¯è¼¸å…¥ + ä¸‹æ‹‰å»ºè­°ï¼‰</label>
    <input id="d_category" list="dishCategoryList">
    <datalist id="dishCategoryList"></datalist>

    <label>åƒ¹æ ¼</label>
    <input id="d_price" type="number" placeholder="åƒ¹æ ¼">

    <label>é è¨­æ•¸é‡</label>
    <input id="d_qty" type="number" value="1">

    <h3 style="margin-top:20px;">é¸é …ç¾¤çµ„</h3>
    <div id="dishGroupsBox"></div>

    <button class="secondary" onclick="addGroup()">æ–°å¢é¸é …ç¾¤çµ„</button>

    <hr style="margin:20px 0; border:1px solid var(--border2)">

    <button class="primary" id="btnSaveDish">æ–°å¢é¤é»</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  renderGroups();

  document.getElementById("btnSaveDish").onclick = ()=>saveDish(restId);
}



// ======================================================
// ğŸ”š ç¬¬ 3-1 æ®µçµæŸï¼ˆä¸‹ä¸€å‰‡é€ç¬¬ 3-2 æ®µï¼‰
// ======================================================
</script>
<script>
/* ======================================================
   ğŸª é¤å»³ç®¡ç†ï¼šè¼‰å…¥å…¨éƒ¨é¤å»³
   ====================================================== */
async function loadRestaurants(){
  const list = document.getElementById("restaurantList");
  list.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("restaurants").orderBy("name").get();

  let html = "";
  snap.forEach(doc=>{
    const d = doc.data();
    html += `
      <details>
        <summary>${d.name}</summary>

        <div class="card" style="margin-top:10px;">
          <label>åº—å</label>
          <input value="${d.name}" data-rest-id="${doc.id}" data-rest-field="name">

          <label>åˆ†é¡ï¼ˆå¯è¼¸å…¥ + ä¸‹æ‹‰å»ºè­°ï¼‰</label>
          <input value="${d.category||""}" list="restCategoryList" data-rest-id="${doc.id}" data-rest-field="category">

          <label>åº—å®¶é»é¤é€£çµï¼ˆorderLinkï¼‰</label>
          <input value="${d.orderLink||""}" data-rest-id="${doc.id}" data-rest-field="orderLink" placeholder="https://....">

          <button class="primary" onclick="saveRestaurant('${doc.id}')">å„²å­˜</button>
        </div>
      </details>
    `;
  });

  list.innerHTML = html;

  generateRestaurantCategoryList();
}


/* ======================================================
   ğŸª å„²å­˜é¤å»³è³‡æ–™ï¼ˆå« orderLinkï¼‰
   ====================================================== */
async function saveRestaurant(id){
  const inputs = document.querySelectorAll(`[data-rest-id="${id}"]`);

  let data = {};
  inputs.forEach(inp=>{
    const field = inp.dataset.restField;
    data[field] = inp.value;
  });

  await db.collection("restaurants").doc(id).update(data);

  alert("å·²å„²å­˜");
}


/* ======================================================
   ğŸª æ–°å¢é¤å»³ï¼ˆDrawerï¼‰
   ====================================================== */
document.getElementById("btnAddRestaurant").onclick = ()=>{
  openDrawer(`
    <h3>æ–°å¢é¤å»³</h3>

    <label>åº—å</label>
    <input id="r_name">

    <label>åˆ†é¡ï¼ˆå¯è¼¸å…¥ + ä¸‹æ‹‰é¸æ“‡ï¼‰</label>
    <input id="r_category" list="restCategoryList">

    <label>åº—å®¶é»é¤é€£çµï¼ˆorderLinkï¼‰</label>
    <input id="r_orderLink" placeholder="https://...">

    <button class="primary" id="btnCreateRestaurant">æ–°å¢</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  document.getElementById("btnCreateRestaurant").onclick = createRestaurant;
};

async function createRestaurant(){
  const data = {
    name: document.getElementById("r_name").value,
    category: document.getElementById("r_category").value,
    orderLink: document.getElementById("r_orderLink").value,
    createdAt: Date.now()
  };

  await db.collection("restaurants").add(data);
  closeDrawer();
  loadRestaurants();
}


/* ======================================================
   ğŸ§© é¤é»ç®¡ç†ï¼šè¼‰å…¥æ‰€æœ‰é¤é»
   ====================================================== */
async function loadMenu(){
  const list = document.getElementById("menuList");
  list.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("menu").orderBy("category").get();

  let html = "";
  snap.forEach(doc=>{
    const d = doc.data();

    html += `
      <details>
        <summary>${d.name}ï¼ˆ${d.price} å…ƒï¼‰</summary>

        <div class="card" style="margin-top:10px;">
          <label>åç¨±</label>
          <input value="${d.name}" data-dish-id="${doc.id}" data-dish-field="name">

          <label>åˆ†é¡</label>
          <input value="${d.category}" list="dishCategoryList" data-dish-id="${doc.id}" data-dish-field="category">

          <label>åƒ¹æ ¼</label>
          <input type="number" value="${d.price}" data-dish-id="${doc.id}" data-dish-field="price">

          <label>é è¨­æ•¸é‡</label>
          <input type="number" value="${d.qty||1}" data-dish-id="${doc.id}" data-dish-field="qty">

          <button class="primary" onclick="saveDishOnly('${doc.id}')">å„²å­˜</button>
        </div>
      </details>
    `;
  });

  list.innerHTML = html;

  generateDishCategoryList();
}


/* ======================================================
   ğŸ’¾ å„²å­˜é¤é»ï¼ˆåŸºæœ¬æ¬„ä½ï¼‰
   ====================================================== */
async function saveDishOnly(id){
  const inputs = document.querySelectorAll(`[data-dish-id="${id}"]`);

  let data = {};
  inputs.forEach(inp=>{
    const f = inp.dataset.dishField;
    data[f] = (inp.type==="number") ? Number(inp.value) : inp.value;
  });

  await db.collection("menu").doc(id).update(data);
  alert("å·²å„²å­˜");
}


/* ======================================================
   â• æ–°å¢é¤é»ï¼ˆå«ç¾¤çµ„æ¨¡çµ„ï¼‰
   ====================================================== */
document.getElementById("btnAddDish").onclick = ()=>showAddDishForm();

async function saveDish(){
  const name = document.getElementById("d_name").value;
  const cat = document.getElementById("d_category").value;
  const price = Number(document.getElementById("d_price").value);
  const qty = Number(document.getElementById("d_qty").value);

  const data = {
    name,
    category: cat,
    price,
    qty,
    groups: currentGroups,   // â­ é¸é …ç¾¤çµ„
    createdAt: Date.now()
  };

  await db.collection("menu").add(data);

  closeDrawer();
  loadMenu();
}


/* ======================================================
   ğŸ“‹ é¤å»³åˆ†é¡ datalistï¼ˆè‡ªå‹•æŠ“æ‰€æœ‰é¤å»³åˆ†é¡ï¼‰
   ====================================================== */
async function generateRestaurantCategoryList(){
  const snap = await db.collection("restaurants").get();
  const set = new Set();

  snap.forEach(doc=>{
    const d = doc.data();
    if(d.category) set.add(d.category);
  });

  const dl = document.getElementById("restCategoryList");
  dl.innerHTML = "";
  set.forEach(c=>{
    dl.innerHTML += `<option value="${c}">`;
  });
}


/* ======================================================
   ğŸ“‹ é¤é»åˆ†é¡ datalist
   ====================================================== */
async function generateDishCategoryList(){
  const snap = await db.collection("menu").get();
  const set = new Set();

  snap.forEach(doc=>{
    const d = doc.data();
    if(d.category) set.add(d.category);
  });

  const dl = document.getElementById("dishCategoryList");
  dl.innerHTML = "";
  set.forEach(c=>{
    dl.innerHTML += `<option value="${c}">`;
  });
}


/* ======================================================
   åˆå§‹åŒ–è¼‰å…¥
   ====================================================== */
loadRestaurants();
loadMenu();


// ğŸ”š ç¬¬ 3-2 æ®µçµæŸï¼Œä¸‹ä¸€æ®µé–‹å§‹é€è¨‚å–®ã€çµ±è¨ˆã€ç¸½æ•´åˆ
</script>
<script>
/* ======================================================
   ğŸ‘¥ äººå“¡æ¸…å–®ï¼ˆéƒ¨é–€ â†’ å±•é–‹æ”¶åˆ + æ’åºï¼‰
   ====================================================== */
async function loadStaff(){
  const box = document.getElementById("staffDeptList");
  box.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("staff").orderBy("dept").get();

  // åˆ†éƒ¨é–€åˆ†çµ„
  const deptMap = new Map();
  snap.forEach(doc=>{
    const d = doc.data();
    if(!deptMap.has(d.dept)) deptMap.set(d.dept, []);
    deptMap.get(d.dept).push({id:doc.id, ...d});
  });

  let html = "";
  deptMap.forEach((arr,dept)=>{
    html += `
      <details>
        <summary>${dept}</summary>
        <div class="card">
          ${arr.map(st=>`
            <div style="display:flex; gap:10px; margin-bottom:10px;">
              <input data-stf-id="${st.id}" data-stf-field="name" value="${st.name}">
              <input data-stf-id="${st.id}" data-stf-field="dept" value="${st.dept}">
              <button class="primary" onclick="saveStaff('${st.id}')">å„²å­˜</button>
            </div>
          `).join("")}
        </div>
      </details>
    `;
  });

  box.innerHTML = html;
}

async function saveStaff(id){
  const inputs = document.querySelectorAll(`[data-stf-id="${id}"]`);
  let data = {};
  inputs.forEach(inp=>{
    data[inp.dataset.stfField] = inp.value;
  });
  await db.collection("staff").doc(id).update(data);
  alert("å·²å„²å­˜");
}

document.getElementById("btnAddStaff").onclick = ()=>{
  openDrawer(`
    <h3>æ–°å¢äººå“¡</h3>

    <label>å§“å</label>
    <input id="s_name">

    <label>éƒ¨é–€</label>
    <input id="s_dept">

    <button class="primary" id="btnCreateStaff">æ–°å¢äººå“¡</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  document.getElementById("btnCreateStaff").onclick = async ()=>{
    await db.collection("staff").add({
      name: document.getElementById("s_name").value,
      dept: document.getElementById("s_dept").value,
      createdAt: Date.now()
    });

    closeDrawer();
    loadStaff();
  };
};


/* ======================================================
   ğŸ§¾ è¨‚å–®ç´€éŒ„ï¼ˆå½™æ•´è¼¸å‡ºï¼‰
   ====================================================== */
document.getElementById("btnLoadOrders").onclick = loadOrdersByDate;

async function loadOrdersByDate(){
  const date = document.getElementById("o_date").value;
  if(!date) return alert("è«‹é¸æ—¥æœŸ");

  const snap = await db.collection("orders")
    .where("date","==",date)
    .orderBy("createdAt")
    .get();

  const box = document.getElementById("orderList");

  if(snap.empty){
    box.innerHTML = `<div class="card">æ­¤æ—¥æœŸæ²’æœ‰è¨‚å–®</div>`;
    return;
  }

  let html = `<div class="card"><table><tr>
      <th>å§“å</th><th>é¤é»</th><th>é‡‘é¡</th><th>æ™‚é–“</th>
  </tr>`;

  snap.forEach(doc=>{
    const o = doc.data();
    html += `
      <tr>
        <td>${o.userName}</td>
        <td>${o.itemName}</td>
        <td>${o.price}</td>
        <td>${new Date(o.createdAt).toLocaleTimeString()}</td>
      </tr>
    `;
  });

  html += `</table></div>`;
  box.innerHTML = html;
}


/* ======================================================
   ğŸ“Š è¨‚å–®çµ±è¨ˆï¼ˆä¾åº—å®¶å½™æ•´ï¼‰
   ====================================================== */
document.getElementById("btnLoadStats").onclick = loadStatsByDate;

async function loadStatsByDate(){
  const date = document.getElementById("s_date").value;
  if(!date) return alert("è«‹é¸æ—¥æœŸ");

  const snap = await db.collection("orders")
    .where("date","==",date)
    .get();

  const box = document.getElementById("statsTable");
  if(snap.empty){
    box.innerHTML = `<div class="card">æ­¤æ—¥æœŸæ²’æœ‰è¨‚å–®</div>`;
    return;
  }

  const map = new Map();

  snap.forEach(doc=>{
    const o = doc.data();
    if(!map.has(o.restaurant)) map.set(o.restaurant,0);
    map.set(o.restaurant, map.get(o.restaurant) + o.price);
  });

  let html = `<div class="card"><table>
    <tr><th>é¤å»³</th><th>ç¸½é‡‘é¡</th></tr>
  `;

  map.forEach((amt,rest)=>{
    html += `<tr><td>${rest}</td><td>${amt}</td></tr>`;
  });

  html += `</table></div>`;
  box.innerHTML = html;
}


/* ======================================================
   ğŸ” æœå°‹éæ¿¾ï¼ˆé¤å»³ / é¤é»ï¼‰
   ====================================================== */
document.getElementById("search_restaurant").oninput = function(){
  const q = this.value.trim();
  const ds = document.querySelectorAll("#restaurantList details");
  ds.forEach(d=>{
    d.style.display = d.querySelector("summary").innerText.includes(q) ? "" : "none";
  });
};

document.getElementById("search_menu").oninput = function(){
  const q = this.value.trim();
  const ds = document.querySelectorAll("#menuList details");
  ds.forEach(d=>{
    d.style.display = d.querySelector("summary").innerText.includes(q) ? "" : "none";
  });
};


/* ======================================================
   ğŸ§¹ Drawer å¤–æŒ‰ ESC/èƒŒæ™¯é—œé–‰
   ====================================================== */
document.addEventListener("keydown",e=>{
  if(e.key==="Escape") closeDrawer();
});


/* ======================================================
   ğŸš€ å…¨éƒ¨åˆå§‹åŒ–
   ====================================================== */
loadStaff();
// loadRestaurants & loadMenu æ—©åœ¨ 3-2 æ®µå·²å‘¼å«é

</script>
</body>
</html>
