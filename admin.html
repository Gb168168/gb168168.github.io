<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GoldBricks å‘·å¥”ğŸ‘½ï½œç®¡ç†è€…</title>

  <!-- SortableJSï¼ˆæ‹–æ›³ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

  <!-- Excelï¼ˆSheetJSï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
/* =========================================================
   ğŸ¨ æ·±ç° C3 + ç²‰è‰² A ä¸»é¡Œ
   ========================================================= */
:root{
  --bg:#1e1e1e;
  --card:#2b2b2b;
  --text:#f3f4f6;
  --muted:#a1a1aa;

  --primary:#fb7185;  /* ç²‰è‰² A */
  --primary-light:#fda4af;

  --border:rgba(255,255,255,.08);
  --border2:rgba(255,255,255,.15);

  --shadow:0 10px 30px rgba(0,0,0,.55);
  --radius:18px;
}

*{
  box-sizing:border-box;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* ======================================================
   Sidebar
   ====================================================== */
#sidebar{
  width:240px;
  background:#151515;
  color:var(--text);
  padding:24px 20px;
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
}

#sidebar .logo{
  font-size:18px;
  font-weight:700;
  margin-bottom:24px;
  color:var(--primary);
}

#sidebar nav button{
  width:100%;
  padding:12px 10px;
  margin-bottom:8px;
  border-radius:10px;
  border:1px solid transparent;
  background:#222;
  color:var(--text);
  text-align:left;
  cursor:pointer;
  transition:.2s;
}

#sidebar nav button:hover{
  background:#333;
  border-color:var(--border2);
}

#sidebar nav button.active{
  background:var(--primary);
  color:#1e1e1e;
  font-weight:700;
}

/* ======================================================
   Main
   ====================================================== */
#main{
  flex:1;
  overflow-y:auto;
  padding:30px;
}

h2{
  margin:0 0 20px;
  font-size:24px;
  font-weight:600;
}

/* ======================================================
   Input / Select / Button
   ====================================================== */
input, select, textarea{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid var(--border2);
  background:#262626;
  color:var(--text);
  margin-bottom:12px;
  font-size:15px;
}

button{
  padding:10px 20px;
  border-radius:12px;
  border:none;
  font-size:15px;
  cursor:pointer;
  transition:.2s;
}

button.primary{
  background:var(--primary);
  color:#1e1e1e;
  font-weight:700;
}

button.primary:hover{
  background:var(--primary-light);
}

button.secondary{
  background:#333;
  color:var(--text);
  border:1px solid var(--border2);
}

button.secondary:hover{
  background:#444;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  border:1px solid var(--border);
  margin-bottom:18px;
}

details{
  background:var(--card);
  padding:16px;
  border-radius:var(--radius);
  border:1px solid var(--border);
  margin-bottom:14px;
}

details summary{
  cursor:pointer;
  font-size:16px;
  font-weight:600;
  color:var(--primary-light);
}

/* ======================================================
   Drawer
   ====================================================== */
#drawer{
  position:fixed;
  top:0;
  right:-420px;
  width:420px;
  height:100%;
  background:var(--card);
  box-shadow:var(--shadow);
  transition:.3s;
  z-index:50;
  padding:22px;
  border-left:1px solid var(--border2);
  overflow-y:auto;
}

#drawer.open{
  right:0;
}

/* ======================================================
   Scrollbar
   ====================================================== */
::-webkit-scrollbar{
  width:8px;
}
::-webkit-scrollbar-thumb{
  background:#555;
  border-radius:4px;
}
::-webkit-scrollbar-thumb:hover{
  background:#777;
}
  </style>
</head>

<body>
  <!-- ====================================================== -->
  <!-- ğŸŸ¦ Sidebar å´æ¬„ -->
  <!-- ====================================================== -->
  <aside id="sidebar">
    <div class="logo">GoldBricks å‘·å¥”ğŸ‘½ï½œç®¡ç†è€…</div>

    <nav>
      <button data-target="view_restaurants">é¤å»³ç®¡ç†</button>
      <button data-target="view_menu">é¤é»ç®¡ç†</button>
      <button data-target="view_staff">äººå“¡æ¸…å–®</button>
      <button data-target="view_orders">è¨‚å–®ç´€éŒ„</button>
      <button data-target="view_stats">è¨‚å–®çµ±è¨ˆ</button>
    </nav>
  </aside>

  <!-- ====================================================== -->
  <!-- ğŸŸ© Main ä¸»å…§å®¹ -->
  <!-- ====================================================== -->
  <main id="main">

    <!-- ============================== -->
    <!-- ğŸ“Œ 1. é¤å»³ç®¡ç† -->
    <!-- ============================== -->
    <section id="view_restaurants" class="page">
      <h2>é¤å»³ç®¡ç†</h2>

      <!-- ğŸ” æœå°‹ -->
      <input id="search_restaurant" placeholder="æœå°‹é¤å»³â€¦">

      <!-- â• æ–°å¢é¤å»³ -->
      <button id="btnAddRestaurant" class="primary">æ–°å¢é¤å»³</button>

      <!-- é¤å»³åˆ—è¡¨ -->
      <div id="restaurantList"></div>
    </section>

    <!-- ============================== -->
    <!-- ğŸ“Œ 2. é¤é»ç®¡ç† -->
    <!-- ============================== -->
    <section id="view_menu" class="page">
      <h2>é¤é»ç®¡ç†</h2>

      <!-- ğŸ” æœå°‹ -->
      <input id="search_menu" placeholder="æœå°‹é¤é»â€¦">

      <!-- â• æ–°å¢é¤é» -->
      <button id="btnAddDish" class="primary">æ–°å¢é¤é»</button>

      <!-- é¤é»åˆ—è¡¨ -->
      <div id="menuList"></div>
    </section>

    <!-- ============================== -->
    <!-- ğŸ“Œ 3. äººå“¡æ¸…å–® -->
    <!-- ============================== -->
    <section id="view_staff" class="page">
      <h2>äººå“¡æ¸…å–®</h2>

      <button id="btnAddStaff" class="primary">æ–°å¢äººå“¡</button>

      <div id="staffDeptList"></div>
    </section>

    <!-- ============================== -->
    <!-- ğŸ“Œ 4. è¨‚å–®ç´€éŒ„ -->
    <!-- ============================== -->
    <section id="view_orders" class="page">
      <h2>è¨‚å–®ç´€éŒ„ï¼ˆå½™æ•´è¼¸å‡ºï¼‰</h2>

      <input type="date" id="o_date">
      <button id="btnLoadOrders" class="primary">è¼‰å…¥è¨‚å–®</button>

      <div id="orderList"></div>
    </section>

    <!-- ============================== -->
    <!-- ğŸ“Œ 5. è¨‚å–®çµ±è¨ˆ -->
    <!-- ============================== -->
    <section id="view_stats" class="page">
      <h2>è¨‚å–®çµ±è¨ˆ</h2>

      <input type="date" id="s_date">
      <button id="btnLoadStats" class="primary">è¼‰å…¥çµ±è¨ˆ</button>

      <div id="statsTable"></div>
    </section>

  </main>

  <!-- ====================================================== -->
  <!-- ğŸŸ§ Drawerï¼ˆå³å´æ“ä½œé¢æ¿ï¼‰ -->
  <!-- ====================================================== -->
  <div id="drawer">
    <div id="drawerContent">
      <!-- å‹•æ…‹æ’å…¥ -->
    </div>
  </div>
<script>
/* ======================================================
   Firebase åˆå§‹åŒ–ï¼ˆè«‹å¡«å…¥ä½ çš„ä¸“æ¡ˆè¨­å®šï¼‰
   ====================================================== */
const firebaseConfig = {
  apiKey: "YOUR-API-KEY",
  authDomain: "YOUR-DOMAIN",
  projectId: "YOUR-PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


/* ======================================================
   Sidebar åˆ‡æ›
   ====================================================== */
const pages = document.querySelectorAll(".page");
const navBtns = document.querySelectorAll("#sidebar nav button");

navBtns.forEach(btn=>{
  btn.addEventListener("click",()=>{
    navBtns.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    const target = btn.dataset.target;
    pages.forEach(p=>p.style.display="none");
    document.getElementById(target).style.display="block";
  });
});

// é è¨­é¡¯ç¤ºé¤å»³ç®¡ç†
document.querySelector("#sidebar nav button").click();


/* ======================================================
   Drawer æ§åˆ¶
   ====================================================== */
const drawer = document.getElementById("drawer");
const drawerContent = document.getElementById("drawerContent");

function openDrawer(html){
  drawerContent.innerHTML = html;
  drawer.classList.add("open");
}

function closeDrawer(){
  drawer.classList.remove("open");
}

document.addEventListener("keydown", e=>{
  if(e.key==="Escape") closeDrawer();
});


/* ======================================================
   å„²å­˜å‰æç¤ºï¼ˆä½ æŒ‡å®šçš„ B å¼·æé†’ï¼‰
   ====================================================== */
function confirmSave(){
  return confirm("âš ï¸ çœŸçš„è¦å„²å­˜å—ï¼Ÿä½¿ç”¨è€…é é¢æœƒé¦¬ä¸Šçœ‹åˆ°é€™äº›è®Šæ›´ã€‚");
}


/* ======================================================
   é¸é …ç¾¤çµ„æ¨¡çµ„
   ====================================================== */
let currentGroups = [];

function addGroup(){
  currentGroups.push({
    id:"grp_"+Date.now(),
    name:"",
    type:"single",
    required:false,
    options:[]
  });
  renderGroups();
}

function renderGroups(){
  const box = document.getElementById("dishGroupsBox");
  if(!box) return;
  box.innerHTML = "";

  currentGroups.forEach(group=>{
    const div = document.createElement("div");
    div.className = "option-group";

    div.innerHTML = `
      <div class="option-group-title">é¸é …ç¾¤çµ„</div>

      <label class="user-visible-label">ç¾¤çµ„åç¨±ï¼ˆä½¿ç”¨è€…å¯è¦‹ï¼‰</label>
      <input data-id="${group.id}" data-field="name" value="${group.name}">

      <label>ç¾¤çµ„é¡å‹</label>
      <select data-id="${group.id}" data-field="type">
        <option value="single" ${group.type==="single"?"selected":""}>æ“‡ä¸€ï¼ˆsingleï¼‰</option>
        <option value="multi"  ${group.type==="multi"?"selected":""}>åŠ è³¼ï¼ˆmultiï¼‰</option>
      </select>

      <label>
        <input type="checkbox" data-id="${group.id}" data-field="required"
          ${group.required?"checked":""}>
        å¿…é¸ï¼ˆåƒ…æ“‡ä¸€ï¼‰
      </label>

      <div class="option-group-title" style="margin-top:12px;">é¸é …å…§å®¹</div>
      <div id="opt_${group.id}">
        ${group.options.map((opt,i)=>`
          <div class="option-item">
            <input data-id="${group.id}" data-opt-index="${i}" data-opt-field="name"
                   value="${opt.name}" placeholder="é¸é …åç¨±">
            <input data-id="${group.id}" data-opt-index="${i}" data-opt-field="price"
                   value="${opt.price}" type="number" placeholder="åƒ¹æ ¼">
            <button class="delete-btn" data-id="${group.id}" data-opt-index="${i}">åˆª</button>
          </div>
        `).join("")}
      </div>

      <button class="secondary" data-add-option="${group.id}">æ–°å¢é¸é …</button>
      <button class="delete-btn" data-del-group="${group.id}" style="margin-top:10px">åˆªé™¤æ­¤ç¾¤çµ„</button>
    `;

    box.appendChild(div);
  });

  attachGroupEvents();
}

function attachGroupEvents(){
  document.querySelectorAll("[data-field]").forEach(inp=>{
    inp.oninput = ()=>{
      const g = currentGroups.find(x=>x.id===inp.dataset.id);
      g[inp.dataset.field] = inp.type==="checkbox" ? inp.checked : inp.value;
    };
  });

  document.querySelectorAll("[data-add-option]").forEach(btn=>{
    btn.onclick = ()=>{
      const g = currentGroups.find(x=>x.id===btn.dataset.addOption);
      g.options.push({name:"",price:0});
      renderGroups();
    };
  });

  document.querySelectorAll(".delete-btn[data-opt-index]").forEach(btn=>{
    btn.onclick = ()=>{
      const g = currentGroups.find(x=>x.id===btn.dataset.id);
      g.options.splice(btn.dataset.optIndex,1);
      renderGroups();
    };
  });

  document.querySelectorAll("[data-del-group]").forEach(btn=>{
    btn.onclick = ()=>{
      currentGroups = currentGroups.filter(x=>x.id!==btn.dataset.delGroup);
      renderGroups();
    };
  });
}


/* ======================================================
   â• æ–°å¢é¤é» Drawer
   ====================================================== */
function showAddDishForm(){
  currentGroups = [];

  openDrawer(`
    <h3>æ–°å¢é¤é»</h3>

    <div class="user-visible-block">
      <label class="user-visible-label">é¤é»åç¨±ï¼ˆä½¿ç”¨è€…å¯è¦‹ï¼‰</label>
      <input id="d_name">

      <label class="user-visible-label">åˆ†é¡ï¼ˆä½¿ç”¨è€…å¯è¦‹ï¼‰</label>
      <input id="d_category" list="dishCategoryList">

      <label class="user-visible-label">åƒ¹æ ¼ï¼ˆä½¿ç”¨è€…å¯è¦‹ï¼‰</label>
      <input id="d_price" type="number">

      <label class="user-visible-label">é è¨­æ•¸é‡ï¼ˆä½¿ç”¨è€…å¯è¦‹ï¼‰</label>
      <input id="d_qty" type="number" value="1">
    </div>

    <h3>é¸é …ç¾¤çµ„</h3>
    <div id="dishGroupsBox"></div>
    <button class="secondary" onclick="addGroup()">æ–°å¢ç¾¤çµ„</button>

    <hr style="margin:20px 0; border:1px solid var(--border2);">

    <button class="primary" id="btnSaveDish">æ–°å¢é¤é»</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  renderGroups();

  document.getElementById("btnSaveDish").onclick = saveDish;
}


/* ======================================================
   ğŸ± é¤é» CRUD
   ====================================================== */
document.getElementById("btnAddDish").onclick = showAddDishForm;

async function saveDish(){
  if(!confirmSave()) return;

  await db.collection("menu").add({
    name:document.getElementById("d_name").value,
    category:document.getElementById("d_category").value,
    price:Number(document.getElementById("d_price").value),
    qty:Number(document.getElementById("d_qty").value),
    groups:currentGroups,
    createdAt:Date.now()
  });

  closeDrawer();
  loadMenu();
}

async function saveDishOnly(id){
  if(!confirmSave()) return;

  const inputs = document.querySelectorAll(`[data-dish-id="${id}"]`);
  let data={};

  inputs.forEach(inp=>{
    data[inp.dataset.dishField] = inp.type==="number" ? Number(inp.value) : inp.value;
  });

  await db.collection("menu").doc(id).update(data);
  alert("å·²å„²å­˜");
}


/* ======================================================
   ğŸ± é¤é»åˆ—è¡¨è¼‰å…¥
   ====================================================== */
async function loadMenu(){
  const box = document.getElementById("menuList");
  box.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("menu").orderBy("category").get();
  let html="";

  snap.forEach(doc=>{
    const d = doc.data();

    html += `
      <details>
        <summary>${d.name}ï¼ˆ${d.price} å…ƒï¼‰</summary>
        <div class="card" style="margin-top:10px;">

          <div class="user-visible-block">
            <label class="user-visible-label">é¤é»åç¨±</label>
            <input value="${d.name}" data-dish-id="${doc.id}" data-dish-field="name">

            <label class="user-visible-label">åˆ†é¡</label>
            <input value="${d.category}" list="dishCategoryList"
                   data-dish-id="${doc.id}" data-dish-field="category">

            <label class="user-visible-label">åƒ¹æ ¼</label>
            <input type="number" value="${d.price}"
                   data-dish-id="${doc.id}" data-dish-field="price">

            <label class="user-visible-label">é è¨­æ•¸é‡</label>
            <input type="number" value="${d.qty||1}"
                   data-dish-id="${doc.id}" data-dish-field="qty">
          </div>

          <button class="primary" onclick="saveDishOnly('${doc.id}')">å„²å­˜</button>
        </div>
      </details>
    `;
  });

  box.innerHTML = html;
  generateDishCategoryList();
}


/* ======================================================
   ğŸª é¤å»³ CRUD
   ====================================================== */
document.getElementById("btnAddRestaurant").onclick = ()=>{
  openDrawer(`
    <h3>æ–°å¢é¤å»³</h3>

    <div class="user-visible-block">
      <label class="user-visible-label">åº—å</label>
      <input id="r_name">

      <label class="user-visible-label">åˆ†é¡</label>
      <input id="r_category" list="restCategoryList">

      <label class="user-visible-label">é»é¤é€£çµ</label>
      <input id="r_orderLink">
    </div>

    <button class="primary" id="btnCreateRestaurant">æ–°å¢</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  document.getElementById("btnCreateRestaurant").onclick = createRestaurant;
};

async function createRestaurant(){
  if(!confirmSave()) return;

  await db.collection("restaurants").add({
    name:document.getElementById("r_name").value,
    category:document.getElementById("r_category").value,
    orderLink:document.getElementById("r_orderLink").value,
    createdAt:Date.now()
  });

  closeDrawer();
  loadRestaurants();
}

async function saveRestaurant(id){
  if(!confirmSave()) return;

  const inputs = document.querySelectorAll(`[data-rest-id="${id}"]`);
  let data={};

  inputs.forEach(inp=>{
    data[inp.dataset.restField] = inp.value;
  });

  await db.collection("restaurants").doc(id).update(data);
  alert("å·²å„²å­˜");
}


/* ======================================================
   ğŸª é¤å»³åˆ—è¡¨è¼‰å…¥
   ====================================================== */
async function loadRestaurants(){
  const box = document.getElementById("restaurantList");
  box.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("restaurants").orderBy("name").get();

  let html="";
  snap.forEach(doc=>{
    const d = doc.data();

    html += `
      <details>
        <summary>${d.name}</summary>
        <div class="card" style="margin-top:10px;">

          <div class="user-visible-block">
            <label class="user-visible-label">åº—å</label>
            <input value="${d.name}" data-rest-id="${doc.id}" data-rest-field="name">

            <label class="user-visible-label">åˆ†é¡</label>
            <input value="${d.category||""}" list="restCategoryList"
                   data-rest-id="${doc.id}" data-rest-field="category">

            <label class="user-visible-label">é»é¤é€£çµ</label>
            <input value="${d.orderLink||""}" data-rest-id="${doc.id}" data-rest-field="orderLink">
          </div>

          <button class="primary" onclick="saveRestaurant('${doc.id}')">å„²å­˜</button>
        </div>
      </details>
    `;
  });

  box.innerHTML = html;
  generateRestaurantCategoryList();
}


/* ======================================================
   datalist è‡ªå‹•ç”Ÿæˆ
   ====================================================== */
async function generateRestaurantCategoryList(){
  const snap = await db.collection("restaurants").get();
  const set = new Set();
  snap.forEach(doc=>{ if(doc.data().category) set.add(doc.data().category); });

  const dl = document.getElementById("restCategoryList");
  if(dl){
    dl.innerHTML = "";
    set.forEach(c=> dl.innerHTML += `<option value="${c}">`);
  }
}

async function generateDishCategoryList(){
  const snap = await db.collection("menu").get();
  const set = new Set();
  snap.forEach(doc=>{ if(doc.data().category) set.add(doc.data().category); });

  const dl = document.getElementById("dishCategoryList");
  if(dl){
    dl.innerHTML = "";
    set.forEach(c=> dl.innerHTML += `<option value="${c}">`);
  }
}


/* ======================================================
   ğŸ‘¥ äººå“¡ç®¡ç†
   ====================================================== */
async function loadStaff(){
  const box = document.getElementById("staffDeptList");
  box.innerHTML = `<div class="card">è¼‰å…¥ä¸­â€¦</div>`;

  const snap = await db.collection("staff").orderBy("dept").get();
  const map = new Map();

  snap.forEach(doc=>{
    const d = doc.data();
    if(!map.has(d.dept)) map.set(d.dept, []);
    map.get(d.dept).push({id:doc.id,...d});
  });

  let html="";
  map.forEach((arr,dept)=>{
    html += `
      <details>
        <summary>${dept}</summary>
        <div class="card" style="margin-top:10px;">
          ${arr.map(st=>`
            <div style="display:flex; gap:10px; margin-bottom:12px;">
              <input data-stf-id="${st.id}" data-stf-field="name" value="${st.name}">
              <input data-stf-id="${st.id}" data-stf-field="dept" value="${st.dept}">
              <button class="primary" onclick="saveStaff('${st.id}')">å„²å­˜</button>
            </div>
          `).join("")}
        </div>
      </details>
    `;
  });

  box.innerHTML = html;
}

async function saveStaff(id){
  if(!confirmSave()) return;

  const inputs = document.querySelectorAll(`[data-stf-id="${id}"]`);
  let data={};
  inputs.forEach(inp=> data[inp.dataset.stfField] = inp.value );

  await db.collection("staff").doc(id).update(data);
  alert("å·²å„²å­˜");
}

document.getElementById("btnAddStaff").onclick = ()=>{
  openDrawer(`
    <h3>æ–°å¢äººå“¡</h3>

    <label>å§“å</label>
    <input id="s_name">

    <label>éƒ¨é–€</label>
    <input id="s_dept">

    <button class="primary" id="btnCreateStaff">æ–°å¢äººå“¡</button>
    <button class="secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
  `);

  document.getElementById("btnCreateStaff").onclick = async ()=>{
    if(!confirmSave()) return;

    await db.collection("staff").add({
      name:document.getElementById("s_name").value,
      dept:document.getElementById("s_dept").value,
      createdAt:Date.now()
    });

    closeDrawer();
    loadStaff();
  };
};


/* ======================================================
   ğŸ§¾ è¨‚å–®ç´€éŒ„
   ====================================================== */
document.getElementById("btnLoadOrders").onclick = loadOrdersByDate;

async function loadOrdersByDate(){
  const date = document.getElementById("o_date").value;
  if(!date) return alert("è«‹é¸æ—¥æœŸ");

  const snap = await db.collection("orders")
    .where("date","==",date)
    .orderBy("createdAt")
    .get();

  const box = document.getElementById("orderList");

  if(snap.empty){
    box.innerHTML = `<div class="card">æ²’æœ‰è¨‚å–®</div>`;
    return;
  }

  let html = `
    <div class="card">
      <table>
        <tr>
          <th>å§“å</th>
          <th>é¤é»</th>
          <th>é‡‘é¡</th>
          <th>æ™‚é–“</th>
        </tr>
  `;

  snap.forEach(doc=>{
    const o = doc.data();
    html += `
      <tr>
        <td>${o.userName}</td>
        <td>${o.itemName}</td>
        <td>${o.price}</td>
        <td>${new Date(o.createdAt).toLocaleTimeString()}</td>
      </tr>
    `;
  });

  html += `</table></div>`;
  box.innerHTML = html;
}


/* ======================================================
   ğŸ“Š è¨‚å–®çµ±è¨ˆ
   ====================================================== */
document.getElementById("btnLoadStats").onclick = loadStatsByDate;

async function loadStatsByDate(){
  const date = document.getElementById("s_date").value;
  if(!date) return alert("è«‹é¸æ—¥æœŸ");

  const snap = await db.collection("orders")
    .where("date","==",date)
    .get();

  const box = document.getElementById("statsTable");

  if(snap.empty){
    box.innerHTML = `<div class="card">æ²’æœ‰è¨‚å–®</div>`;
    return;
  }

  const map = new Map();
  snap.forEach(doc=>{
    const o = doc.data();
    if(!map.has(o.restaurant)) map.set(o.restaurant, 0);
    map.set(o.restaurant, map.get(o.restaurant) + o.price);
  });

  let html = `
    <div class="card">
      <table>
        <tr>
          <th>é¤å»³</th>
          <th>ç¸½é‡‘é¡</th>
        </tr>
  `;

  map.forEach((amt, name)=>{
    html += `<tr><td>${name}</td><td>${amt}</td></tr>`;
  });

  html += `</table></div>`;
  box.innerHTML = html;
}


/* ======================================================
   æœå°‹
   ====================================================== */
document.getElementById("search_restaurant").oninput = function(){
  const q = this.value.trim();
  document.querySelectorAll("#restaurantList details")
    .forEach(it => it.style.display = it.querySelector("summary").innerText.includes(q) ? "" : "none");
};

document.getElementById("search_menu").oninput = function(){
  const q = this.value.trim();
  document.querySelectorAll("#menuList details")
    .forEach(it => it.style.display = it.querySelector("summary").innerText.includes(q) ? "" : "none");
};


/* ======================================================
   ğŸš€ åˆå§‹åŒ–
   ====================================================== */
loadRestaurants();
loadMenu();
loadStaff();
</script>

</body>
</html>

