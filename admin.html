<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoldBricks — 管理後台</title>
<style>
  :root {
    --bg: #020617;
    --bg-soft: #0b1220;
    --panel: #111827;
    --border: #1f2937;
    --accent: #3b82f6;
    --accent2: #1d4ed8;
    --text: #e5e7eb;
    --text-soft: #9ca3af;
    --danger: #f97373;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  /* 上方列：漢堡 + GoldBricks + 搜尋 + 按鈕預留位置（右邊空著即可） */
  .top-bar{
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px 14px;
    background:#020617;
    border-bottom:1px solid var(--border);
    position:sticky;
    top:0;
    z-index:10;
  }
  .menu-btn{
    border-radius:999px;
    border:1px solid var(--border);
    padding:6px 10px;
    background:transparent;
    color:var(--text);
    font-size:18px;
  }
  .logo{
    font-size:20px;
    font-weight:700;
    flex-shrink:0;
  }
  .search-wrap{
    flex:1;
    display:flex;
    gap:6px;
  }
  .search-wrap input{
    flex:1;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--text);
    font-size:14px;
  }
  .search-wrap input::placeholder{ color:var(--text-soft); }
  .search-btn{
    padding:8px 12px;
    border-radius:999px;
    border:none;
    background:var(--accent);
    color:#fff;
    font-size:13px;
  }

  /* 版面 */
  .layout{ display:flex; min-height:calc(100vh - 44px); }

  /* 側邊選單 */
  .side{
    width:220px;
    background:var(--panel);
    border-right:1px solid var(--border);
    padding:14px 10px;
  }
  .side-title{
    font-size:13px;
    color:var(--text-soft);
    margin:0 0 8px 6px;
    text-transform:uppercase;
  }
  .menu-list{ list-style:none; padding:0; margin:0 0 10px 0; }
  .menu-list li{ margin-bottom:4px; }
  .menu-list button{
    width:100%;
    text-align:left;
    padding:8px 10px;
    border-radius:10px;
    border:none;
    background:transparent;
    color:var(--text-soft);
    font-size:14px;
  }
  .menu-list button.active,
  .menu-list button:hover{
    background:rgba(59,130,246,0.2);
    color:var(--text);
  }
  .side-divider{
    border-top:1px solid var(--border);
    margin:8px 0;
  }

  @media(max-width:768px){
    .layout{ flex-direction:column; }
    .side{
      position:fixed;
      top:44px;
      left:-240px;
      height:calc(100vh - 44px);
      z-index:20;
      transition:left .2s;
    }
    .side.open{ left:0; }
  }

  /* 內容區 */
  .content{
    flex:1;
    padding:14px 14px 40px;
    background:var(--bg);
  }
  .section{
    background:var(--bg-soft);
    border-radius:14px;
    padding:14px 14px 18px;
    border:1px solid var(--border);
    margin-bottom:14px;
    display:none; /* 預設都關掉 */
  }
  .section.active{ display:block; }
  .section-header{
    display:flex;
    justify-content:space-between;
    align-items:baseline;
    margin-bottom:8px;
  }
  .section-title{
    font-size:16px;
    font-weight:600;
  }
  .section-sub{
    font-size:12px;
    color:var(--text-soft);
  }
  .tag{
    font-size:11px;
    padding:2px 8px;
    border-radius:999px;
    background:rgba(148,163,184,0.2);
    margin-left:6px;
    color:var(--text-soft);
  }
  .two-col{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:10px;
  }
  label{
    font-size:13px;
    color:var(--text-soft);
    display:block;
    margin-bottom:3px;
  }
  input[type="text"],
  input[type="number"],
  input[type="date"],
  textarea,
  select{
    width:100%;
    padding:8px 10px;
    border-radius:10px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--text);
    font-size:14px;
  }
  textarea{ min-height:60px; resize:vertical; }
  input::placeholder,textarea::placeholder{ color:var(--text-soft); }
  .field{ margin-bottom:10px; }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:8px 14px;
    border-radius:999px;
    border:none;
    font-size:14px;
    cursor:pointer;
    margin-top:4px;
  }
  .btn-primary{
    background:linear-gradient(90deg,var(--accent),var(--accent2));
    color:#fff;
  }
  .btn-outline{
    background:transparent;
    border:1px solid var(--border);
    color:var(--text-soft);
  }
  .pill{
    display:inline-flex;
    align-items:center;
    padding:3px 8px;
    border-radius:999px;
    background:#020617;
    border:1px solid var(--border);
    font-size:12px;
    margin:2px 4px 0 0;
    gap:4px;
  }
  .pill button{
    border:none;
    background:transparent;
    color:var(--danger);
    font-size:12px;
    padding:0;
    cursor:pointer;
  }

  /* 餐廳列表 */
  .restaurant-list{
    margin-top:6px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
    gap:8px;
  }
  .rest-card{
    display:flex;
    gap:8px;
    padding:8px;
    background:#020617;
    border-radius:12px;
    border:1px solid var(--border);
    font-size:12px;
  }
  .rest-thumb{
    width:60px;
    height:60px;
    border-radius:10px;
    background:#0f172a;
    object-fit:cover;
    flex-shrink:0;
  }
  .rest-name{
    font-size:14px;
    font-weight:600;
    margin-bottom:2px;
  }
  .btn-mini{
    padding:3px 6px;
    font-size:11px;
    border-radius:999px;
    border:1px solid var(--border);
    background:transparent;
    color:var(--text-soft);
    margin-top:2px;
    cursor:pointer;
  }

  /* 餐點列表 */
  table{ width:100%; border-collapse:collapse; font-size:12px; }
  th,td{ padding:4px 4px; border-bottom:1px solid var(--border); text-align:left; }
  th{ color:var(--text-soft); font-weight:500; }
  .text-right{text-align:right;}

  /* 加購項目 */
  .addon-row{
    display:grid;
    grid-template-columns:1.4fr 0.8fr auto;
    gap:6px;
    margin-bottom:6px;
    align-items:center;
  }
  .danger{ color:var(--danger); }
</style>
</head>
<body>

<!-- 上方列 -->
<div class="top-bar">
  <button class="menu-btn" id="menuToggle">≡</button>
  <div class="logo">GoldBricks</div>
  <div class="search-wrap">
    <input id="globalSearch" type="text" placeholder="輸入餐廳名稱查詢…">
    <button class="search-btn" id="searchBtn">搜尋</button>
  </div>
</div>

<div class="layout">
  <!-- 側邊 -->
  <aside class="side" id="sideMenu">
    <p class="side-title">管理選單</p>
    <ul class="menu-list" id="mainMenu">
      <li><button data-target="staffSec">新增人員</button></li>
      <li><button data-target="restSec" class="active">餐廳管理</button></li>
      <li><button data-target="statSec">訂單統計</button></li>
      <li><button data-target="orderSec">訂單管理</button></li>
    </ul>

    <div class="side-divider"></div>

    <ul class="menu-list">
      <li><button id="switchUserBtn">切換到使用者模式</button></li>
      <li><button id="logoutBtn">登出</button></li>
    </ul>
  </aside>

  <!-- 內容 -->
  <main class="content">
    <!-- 新增人員 -->
    <section class="section" id="staffSec">
      <div class="section-header">
        <div>
          <span class="section-title">新增人員</span>
          <span class="tag">部門 / 人員</span>
        </div>
        <div class="section-sub">設定部門與人員，供使用者點餐時選擇</div>
      </div>
      <div class="two-col">
        <div>
          <div class="field">
            <label>部門名稱</label>
            <input id="deptInput" type="text" placeholder="例如：業務一部">
          </div>
          <div class="field">
            <label>人員姓名</label>
            <input id="staffInput" type="text" placeholder="例如：王小明">
          </div>
          <button class="btn btn-primary" id="addStaffBtn">新增人員</button>
        </div>
        <div>
          <label>已建立部門 / 人員</label>
          <div id="staffList"></div>
        </div>
      </div>
    </section>

    <!-- 餐廳管理 -->
    <section class="section active" id="restSec">
      <div class="section-header">
        <div>
          <span class="section-title">餐廳管理</span>
          <span class="tag">新增餐廳</span>
        </div>
        <div class="section-sub">餐廳名稱、電話、地址、備註、Google Map、圖片上傳</div>
      </div>
      <div class="two-col">
        <div>
          <div class="field">
            <label>餐廳名稱</label>
            <input id="restName" type="text" placeholder="例如：鴨門現炒（必填）">
          </div>
          <div class="field">
            <label>電話</label>
            <input id="restPhone" type="text" placeholder="02-1234-5678">
          </div>
          <div class="field">
            <label>地址</label>
            <input id="restAddr" type="text" placeholder="餐廳地址">
          </div>
          <div class="field">
            <label>備註</label>
            <textarea id="restNote" placeholder="例如：只收現金、可加飯、不吃辣請備註"></textarea>
          </div>
          <div class="field">
            <label>Google Map 連結</label>
            <input id="restMap" type="text" placeholder="貼上地圖網址">
          </div>
          <div class="field">
            <label>餐廳圖片上傳</label>
            <input id="restImg" type="file" accept="image/*">
          </div>
          <button class="btn btn-primary" id="addRestBtn">新增餐廳</button>
        </div>

        <div>
          <label>已新增餐廳</label>
          <div class="restaurant-list" id="restList"></div>
        </div>
      </div>
    </section>

    <!-- 訂單統計 -->
    <section class="section" id="statSec">
      <div class="section-header">
        <div>
          <span class="section-title">訂單統計</span>
          <span class="tag">日期 + 模式</span>
        </div>
        <div class="section-sub">起始日 / 結束日，模式：店家 / 部門 / 人員</div>
      </div>
      <div class="two-col">
        <div>
          <div class="field">
            <label>起始日</label>
            <input id="statStart" type="date">
          </div>
          <div class="field">
            <label>結束日</label>
            <input id="statEnd" type="date">
          </div>
          <div class="field">
            <label>統計模式</label>
            <select id="statMode">
              <option value="store">店家</option>
              <option value="dept">部門</option>
              <option value="staff">人員</option>
            </select>
          </div>
          <button class="btn btn-primary">產生統計（之後串訂單）</button>
        </div>
        <div>
          <label>統計結果</label>
          <p class="section-sub">之後會依訂單資料顯示各餐廳 / 部門 / 人員的統計。</p>
        </div>
      </div>
    </section>

    <!-- 訂單管理 -->
    <section class="section" id="orderSec">
      <div class="section-header">
        <div>
          <span class="section-title">訂單管理</span>
          <span class="tag">餐點彙整</span>
        </div>
        <div class="section-sub">
          相同餐點名稱排序在一起，預算 140 超過部分顯示 <span class="danger">紅字應付金額</span>。
        </div>
      </div>
      <p class="section-sub">
        這裡先預留版位，等使用者點餐頁完成後會在此顯示：<br>
        排骨飯70+蛋10 數量2；排骨飯70 數量1；豬腳飯80+菜30 數量1 … 等彙整結果。
      </p>
    </section>
  </main>
</div>

<script>
  // 1️⃣ 角色檢查：不是 admin 就踢回登入頁
  (function checkAdmin() {
    const role = localStorage.getItem('gb_role');
    if (role !== 'admin') {
      window.location.href = 'index.html';
    }
  })();

  // 側邊漢堡
  const menuToggle = document.getElementById('menuToggle');
  const sideMenu   = document.getElementById('sideMenu');
  menuToggle.addEventListener('click', () => {
    sideMenu.classList.toggle('open');
  });

  // 側邊主選單：切換 section
  const mainMenuBtns = document.querySelectorAll('#mainMenu button');
  const sections = document.querySelectorAll('.section');
  mainMenuBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      mainMenuBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const targetId = btn.dataset.target;
      sections.forEach(sec => {
        sec.classList.toggle('active', sec.id === targetId);
      });
      sideMenu.classList.remove('open');
    });
  });

  // 2️⃣ 切換到使用者模式
  document.getElementById('switchUserBtn').addEventListener('click', () => {
    localStorage.setItem('gb_role', 'user');
    window.location.href = 'user.html'; // 之後會做的使用者頁
  });

  // 3️⃣ 登出
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('gb_role');
    window.location.href = 'index.html';
  });

  // 4️⃣ 新增人員 + 刪除
  const staffData = [];
  const deptInput  = document.getElementById('deptInput');
  const staffInput = document.getElementById('staffInput');
  const staffList  = document.getElementById('staffList');

  document.getElementById('addStaffBtn').addEventListener('click', () => {
    const dept  = deptInput.value.trim();
    const staff = staffInput.value.trim();
    if (!dept || !staff) {
      alert('請輸入部門與人員姓名');
      return;
    }
    staffData.push({ id: Date.now(), dept, staff });
    deptInput.value = '';
    staffInput.value = '';
    renderStaff();
  });

  function renderStaff() {
    staffList.innerHTML = '';
    staffData.forEach(item => {
      const pill = document.createElement('div');
      pill.className = 'pill';
      pill.innerHTML = `
        <span>${item.dept} - ${item.staff}</span>
        <button type="button">✕</button>
      `;
      pill.querySelector('button').addEventListener('click', () => {
        const idx = staffData.findIndex(s => s.id === item.id);
        if (idx !== -1) staffData.splice(idx, 1);
        renderStaff();
      });
      staffList.appendChild(pill);
    });
  }

  // 5️⃣ 餐廳資料
  const restaurants = [];
  const restName = document.getElementById('restName');
  const restPhone= document.getElementById('restPhone');
  const restAddr = document.getElementById('restAddr');
  const restNote = document.getElementById('restNote');
  const restMap  = document.getElementById('restMap');
  const restImg  = document.getElementById('restImg');
  const restList = document.getElementById('restList');

  document.getElementById('addRestBtn').addEventListener('click', () => {
    const name = restName.value.trim();
    if (!name) { alert('餐廳名稱為必填'); return; }

    const data = {
      id: Date.now(),
      name,
      phone: restPhone.value.trim(),
      addr : restAddr.value.trim(),
      note : restNote.value.trim(),
      map  : restMap.value.trim(),
      img  : null
    };

    const file = restImg.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        data.img = e.target.result;
        pushRestaurant(data);
      };
      reader.readAsDataURL(file);
    } else {
      pushRestaurant(data);
    }
  });

  function pushRestaurant(r) {
    restaurants.push(r);
    restName.value=''; restPhone.value=''; restAddr.value='';
    restNote.value=''; restMap.value=''; restImg.value='';
    renderRestaurants();
  }

  function renderRestaurants() {
    restList.innerHTML = '';
    restaurants.forEach((r, idx) => {
      const card = document.createElement('div');
      card.className = 'rest-card';

      const img = document.createElement('img');
      img.className = 'rest-thumb';
      if (r.img) img.src = r.img; else img.alt = 'no image';

      const info = document.createElement('div');
      info.style.flex = '1';
      info.innerHTML = `
        <div class="rest-name">${r.name}</div>
        <div>${r.phone || ''}</div>
        <div>${r.addr || ''}</div>
        <div class="section-sub" style="margin-top:2px;">${r.note || ''}</div>
      `;

      const btns = document.createElement('div');
      const up = document.createElement('button');
      up.className = 'btn-mini';
      up.textContent = '上移';
      up.onclick = () => moveRestaurant(idx, -1);
      const down = document.createElement('button');
      down.className = 'btn-mini';
      down.textContent = '下移';
      down.onclick = () => moveRestaurant(idx, 1);
      btns.appendChild(up);
      btns.appendChild(down);

      card.appendChild(img);
      card.appendChild(info);
      card.appendChild(btns);
      restList.appendChild(card);
    });
  }

  function moveRestaurant(i, dir) {
    const j = i + dir;
    if (j < 0 || j >= restaurants.length) return;
    const tmp = restaurants[i];
    restaurants[i] = restaurants[j];
    restaurants[j] = tmp;
    renderRestaurants();
  }

  // 6️⃣ 搜尋餐廳：按按鈕或 Enter 都會觸發
  const searchInput = document.getElementById('globalSearch');
  const searchBtn   = document.getElementById('searchBtn');

  function doSearch() {
    const keyword = searchInput.value.trim().toLowerCase();
    document.querySelectorAll('.rest-card').forEach(card => {
      const nameEl = card.querySelector('.rest-name');
      if (!nameEl) return;
      const text = nameEl.textContent.toLowerCase();
      const match = !keyword || text.includes(keyword);
      card.style.display = match ? 'flex' : 'none';
      nameEl.style.color = match && keyword ? '#38bdf8' : '#e5e7eb';
    });
  }

  searchBtn.addEventListener('click', doSearch);
  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      doSearch();
    }
  });
</script>
</body>
</html>
