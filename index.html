<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>GoldBricks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #222;
    }
    header {
      background: #111;
      color: #fff;
      padding: 16px 20px;
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header span {
      font-size: 14px;
      opacity: .8;
    }
    main {
      max-width: 1100px;
      margin: 20px auto 40px;
      padding: 0 16px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 18px;
      margin-bottom: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,.04);
    }
    h2 {
      margin: 0 0 12px;
      font-size: 18px;
    }
    h3 {
      margin: 16px 0 8px;
      font-size: 16px;
    }
    label {
      display: block;
      font-size: 14px;
      margin: 6px 0 2px;
    }
    select, input[type="text"], input[type="password"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      margin-top: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      background: #111;
      color: #fff;
    }
    button.secondary {
      background: #eee;
      color: #333;
      border: 1px solid #ddd;
    }
    button:disabled {
      opacity: .5;
      cursor: not-allowed;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .col {
      flex: 1 1 220px;
      min-width: 0;
    }
    .hidden {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 4px 6px;
      text-align: left;
    }
    th {
      background: #fafafa;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #f0f0f0;
      margin-right: 4px;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #222;
      color: #fff;
      margin-left: 4px;
    }
    .section-divider {
      border-top: 1px dashed #ddd;
      margin: 14px 0;
    }
    @media (max-width: 640px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>GoldBricks</div>
    <span id="currentRoleText">目前身分：未登入</span>
  </header>

  <main>
    <!-- 身分選擇 / 登入 -->
    <section class="card" id="roleCard">
      <h2>選擇身分</h2>
      <div class="row">
        <div class="col">
          <label for="roleSelect">身分</label>
          <select id="roleSelect">
            <option value="user">一般使用者</option>
            <option value="admin">管理員</option>
          </select>
        </div>
      </div>

      <div id="adminLoginArea" class="row hidden" style="margin-top:8px;">
        <div class="col">
          <label for="adminPassword">管理員密碼</label>
          <input type="password" id="adminPassword" placeholder="請輸入管理員密碼" />
        </div>
        <div class="col" style="align-self:flex-end;">
          <button id="adminLoginBtn">管理員登入</button>
        </div>
      </div>

      <div style="margin-top:8px;">
        <small>※ 此版本為前端 demo，管理員密碼只是前端檢查，不適合放到真正對外的公開網站喔。</small>
      </div>
    </section>

    <!-- 一般使用者：點餐 -->
    <section class="card hidden" id="userPanel">
      <h2>一般使用者點餐</h2>

      <div class="row">
        <div class="col">
          <label for="userDeptSelect">部門</label>
          <select id="userDeptSelect">
            <option value="">請選擇部門</option>
          </select>
        </div>
        <div class="col">
          <label for="userNameSelect">姓名（只會出現該部門的人）</label>
          <select id="userNameSelect">
            <option value="">請先選擇部門</option>
          </select>
        </div>
      </div>

      <div class="section-divider"></div>

      <h3>選擇餐點</h3>
      <div class="row">
        <div class="col">
          <label for="categorySelect">餐別</label>
          <select id="categorySelect">
            <option value="">請選擇</option>
            <option value="早餐">早餐</option>
            <option value="便當">便當</option>
            <option value="粥品">粥品</option>
            <option value="火鍋">火鍋</option>
            <option value="飲料">飲料</option>
          </select>
        </div>
        <div class="col">
          <label for="restaurantSelect">店家</label>
          <select id="restaurantSelect">
            <option value="">請先選擇餐別</option>
          </select>
        </div>
        <div class="col">
          <label for="itemSelect">餐點</label>
          <select id="itemSelect">
            <option value="">請先選擇店家</option>
          </select>
        </div>
      </div>
      <button id="placeOrderBtn">送出訂單</button>

      <div id="userMessage" style="margin-top:6px;font-size:13px;color:#c00;"></div>

      <div class="section-divider"></div>

      <h3>我的訂單</h3>
      <div id="userOrdersArea">
        <small>請先選擇部門與姓名。</small>
      </div>
    </section>

    <!-- 管理員：管理 & 統計 -->
    <section class="card hidden" id="adminPanel">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2>管理員後台</h2>
        <button class="secondary" id="adminLogoutBtn">切換為一般使用者</button>
      </div>

      <h3>人員管理</h3>
      <div class="row">
        <div class="col">
          <label for="adminPersonName">姓名</label>
          <input type="text" id="adminPersonName" placeholder="例如：小明" />
        </div>
        <div class="col">
          <label for="adminPersonDept">部門</label>
          <select id="adminPersonDept"></select>
        </div>
        <div class="col" style="align-self:flex-end;">
          <button id="addPersonBtn">新增人員</button>
        </div>
      </div>

      <div id="peopleListArea" style="margin-top:8px;font-size:13px;"></div>

      <div class="section-divider"></div>

      <h3>餐廳管理</h3>
      <div class="row">
        <div class="col">
          <label for="adminRestaurantCategory">餐別</label>
          <select id="adminRestaurantCategory">
            <option value="早餐">早餐</option>
            <option value="便當">便當</option>
            <option value="粥品">粥品</option>
            <option value="火鍋">火鍋</option>
            <option value="飲料">飲料</option>
          </select>
        </div>
        <div class="col">
          <label for="adminRestaurantName">餐廳名稱</label>
          <input type="text" id="adminRestaurantName" placeholder="例如：弘爺、中和店" />
        </div>
        <div class="col" style="align-self:flex-end;">
          <button id="addRestaurantBtn">新增餐廳</button>
        </div>
      </div>

      <div id="restaurantListArea" style="margin-top:8px;font-size:13px;"></div>

      <div class="section-divider"></div>

      <h3>餐點管理</h3>
      <div class="row">
        <div class="col">
          <label for="adminItemRestaurant">餐廳</label>
          <select id="adminItemRestaurant">
            <option value="">請先新增餐廳</option>
          </select>
        </div>
        <div class="col">
          <label for="adminItemName">餐點名稱</label>
          <input type="text" id="adminItemName" placeholder="例如：蛋餅、火腿蛋吐司…" />
        </div>
        <div class="col" style="align-self:flex-end;">
          <button id="addItemBtn">新增餐點</button>
        </div>
      </div>

      <div id="itemListArea" style="margin-top:8px;font-size:13px;"></div>

      <div class="section-divider"></div>

      <h3>訂單統計（依人員）</h3>
      <div id="statsArea" style="font-size:13px;"></div>
    </section>
  </main>

  <script>
    // === 設定區 ===
    const ADMIN_PASSWORD = "1234"; // 你可以改這個密碼
    const DEPARTMENTS = ["管理部", "FAE", "TSE", "新場", "倉管", "數據分析", "RD", "線上客服", "維運"];

    const STORAGE_KEY = "orderSystemData_v1";

    function defaultData() {
      return {
        people: [], // {id, name, department}
        restaurants: [], // {id, name, category}
        items: [], // {id, restaurantId, name}
        orders: [] // {id, personId, restaurantId, itemId, time}
      };
    }

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return defaultData();
        return JSON.parse(raw);
      } catch (e) {
        console.error(e);
        return defaultData();
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let data = loadData();

    // ===== DOM =====
    const currentRoleText = document.getElementById("currentRoleText");
    const roleSelect = document.getElementById("roleSelect");
    const adminLoginArea = document.getElementById("adminLoginArea");
    const adminPasswordInput = document.getElementById("adminPassword");
    const adminLoginBtn = document.getElementById("adminLoginBtn");

    const userPanel = document.getElementById("userPanel");
    const adminPanel = document.getElementById("adminPanel");

    const userDeptSelect = document.getElementById("userDeptSelect");
    const userNameSelect = document.getElementById("userNameSelect");
    const categorySelect = document.getElementById("categorySelect");
    const restaurantSelect = document.getElementById("restaurantSelect");
    const itemSelect = document.getElementById("itemSelect");
    const placeOrderBtn = document.getElementById("placeOrderBtn");
    const userMessage = document.getElementById("userMessage");
    const userOrdersArea = document.getElementById("userOrdersArea");

    const adminLogoutBtn = document.getElementById("adminLogoutBtn");
    const adminPersonName = document.getElementById("adminPersonName");
    const adminPersonDept = document.getElementById("adminPersonDept");
    const addPersonBtn = document.getElementById("addPersonBtn");
    const peopleListArea = document.getElementById("peopleListArea");

    const adminRestaurantCategory = document.getElementById("adminRestaurantCategory");
    const adminRestaurantName = document.getElementById("adminRestaurantName");
    const addRestaurantBtn = document.getElementById("addRestaurantBtn");
    const restaurantListArea = document.getElementById("restaurantListArea");

    const adminItemRestaurant = document.getElementById("adminItemRestaurant");
    const adminItemName = document.getElementById("adminItemName");
    const addItemBtn = document.getElementById("addItemBtn");
    const itemListArea = document.getElementById("itemListArea");

    const statsArea = document.getElementById("statsArea");

    let isAdmin = false;

    // ===== 初始化下拉選單 =====
    function initDepartmentSelects() {
      // user 部門
      userDeptSelect.innerHTML = '<option value="">請選擇部門</option>';
      DEPARTMENTS.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        userDeptSelect.appendChild(opt);
      });

      // admin 人員管理部門
      adminPersonDept.innerHTML = "";
      DEPARTMENTS.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        adminPersonDept.appendChild(opt);
      });
    }

    function refreshPeopleList() {
      if (data.people.length === 0) {
        peopleListArea.textContent = "目前尚未新增人員。";
        return;
      }
      let html = "<table><thead><tr><th>姓名</th><th>部門</th></tr></thead><tbody>";
      data.people.forEach(p => {
        html += `<tr><td>${p.name}</td><td>${p.department}</td></tr>`;
      });
      html += "</tbody></table>";
      peopleListArea.innerHTML = html;
    }

    function refreshUserNameOptions() {
      const dept = userDeptSelect.value;
      userNameSelect.innerHTML = "";
      if (!dept) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "請先選擇部門";
        userNameSelect.appendChild(opt);
        return;
      }
      const peopleInDept = data.people.filter(p => p.department === dept);
      if (peopleInDept.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "此部門尚未新增人員（請請管理員新增）";
        userNameSelect.appendChild(opt);
        return;
      }
      const firstOpt = document.createElement("option");
      firstOpt.value = "";
      firstOpt.textContent = "請選擇姓名";
      userNameSelect.appendChild(firstOpt);
      peopleInDept.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name;
        userNameSelect.appendChild(opt);
      });
    }

    function refreshRestaurantList() {
      if (data.restaurants.length === 0) {
        restaurantListArea.textContent = "目前尚未新增餐廳。";
      } else {
        let html = "<table><thead><tr><th>餐廳名稱</th><th>餐別</th></tr></thead><tbody>";
        data.restaurants.forEach(r => {
          html += `<tr><td>${r.name}</td><td>${r.category}</td></tr>`;
        });
        html += "</tbody></table>";
        restaurantListArea.innerHTML = html;
      }

      // 管理員新增餐點用的餐廳下拉
      adminItemRestaurant.innerHTML = "";
      if (data.restaurants.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "請先新增餐廳";
        adminItemRestaurant.appendChild(opt);
      } else {
        const opt0 = document.createElement("option");
        opt0.value = "";
        opt0.textContent = "請選擇餐廳";
        adminItemRestaurant.appendChild(opt0);
        data.restaurants.forEach(r => {
          const opt = document.createElement("option");
          opt.value = r.id;
          opt.textContent = `${r.name}（${r.category}）`;
          adminItemRestaurant.appendChild(opt);
        });
      }
    }

    function refreshItemList() {
      if (data.items.length === 0) {
        itemListArea.textContent = "目前尚未新增餐點。";
        return;
      }
      let html = "<table><thead><tr><th>餐點名稱</th><th>餐廳</th></tr></thead><tbody>";
      data.items.forEach(it => {
        const restaurant = data.restaurants.find(r => r.id === it.restaurantId);
        html += `<tr><td>${it.name}</td><td>${restaurant ? restaurant.name : "（已刪除餐廳）"}</td></tr>`;
      });
      html += "</tbody></table>";
      itemListArea.innerHTML = html;
    }

    function refreshRestaurantOptionsForUser() {
      const category = categorySelect.value;
      restaurantSelect.innerHTML = "";
      itemSelect.innerHTML = '<option value="">請先選擇店家</option>';

      if (!category) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "請先選擇餐別";
        restaurantSelect.appendChild(opt);
        return;
      }
      const list = data.restaurants.filter(r => r.category === category);
      if (list.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "此餐別尚未新增餐廳（請請管理員新增）";
        restaurantSelect.appendChild(opt);
        return;
      }
      const firstOpt = document.createElement("option");
      firstOpt.value = "";
      firstOpt.textContent = "請選擇餐廳";
      restaurantSelect.appendChild(firstOpt);
      list.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r.id;
        opt.textContent = r.name;
        restaurantSelect.appendChild(opt);
      });
    }

    function refreshItemOptionsForUser() {
      const restaurantId = restaurantSelect.value;
      itemSelect.innerHTML = "";
      if (!restaurantId) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "請先選擇店家";
        itemSelect.appendChild(opt);
        return;
      }
      const list = data.items.filter(it => it.restaurantId === restaurantId);
      if (list.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "此店家尚未新增餐點（請請管理員新增）";
        itemSelect.appendChild(opt);
        return;
      }
      const firstOpt = document.createElement("option");
      firstOpt.value = "";
      firstOpt.textContent = "請選擇餐點";
      itemSelect.appendChild(firstOpt);
      list.forEach(it => {
        const opt = document.createElement("option");
        opt.value = it.id;
        opt.textContent = it.name;
        itemSelect.appendChild(opt);
      });
    }

    function renderUserOrders() {
      const personId = userNameSelect.value;
      if (!personId) {
        userOrdersArea.innerHTML = "<small>請先選擇部門與姓名。</small>";
        return;
      }
      const myOrders = data.orders.filter(o => o.personId === personId);
      if (myOrders.length === 0) {
        userOrdersArea.innerHTML = "<small>目前尚未有訂單。</small>";
        return;
      }
      let html = "<table><thead><tr><th>時間</th><th>餐別</th><th>餐廳</th><th>餐點</th></tr></thead><tbody>";
      myOrders.forEach(o => {
        const restaurant = data.restaurants.find(r => r.id === o.restaurantId);
        const item = data.items.find(it => it.id === o.itemId);
        const timeStr = new Date(o.time).toLocaleString();
        html += `<tr>
          <td>${timeStr}</td>
          <td>${restaurant ? restaurant.category : ""}</td>
          <td>${restaurant ? restaurant.name : ""}</td>
          <td>${item ? item.name : ""}</td>
        </tr>`;
      });
      html += "</tbody></table>";
      userOrdersArea.innerHTML = html;
    }

    function renderStats() {
      if (data.orders.length === 0) {
        statsArea.textContent = "目前尚未有任何訂單。";
        return;
      }
      const map = {}; // personId -> {count, detail}
      data.orders.forEach(o => {
        if (!map[o.personId]) {
          map[o.personId] = { count: 0, detail: [] };
        }
        map[o.personId].count += 1;
        const restaurant = data.restaurants.find(r => r.id === o.restaurantId);
        const item = data.items.find(it => it.id === o.itemId);
        map[o.personId].detail.push({
          restaurant: restaurant ? restaurant.name : "",
          category: restaurant ? restaurant.category : "",
          item: item ? item.name : "",
          time: o.time
        });
      });

      let html = "";
      data.people.forEach(p => {
        const st = map[p.id];
        const count = st ? st.count : 0;
        html += `<div style="margin-bottom:8px;">
          <strong>${p.name}</strong>
          <span class="pill">${p.department}</span>
          <span style="margin-left:8px;">共 ${count} 筆訂單</span>
        </div>`;
        if (st) {
          html += "<table><thead><tr><th>時間</th><th>餐別</th><th>餐廳</th><th>餐點</th></tr></thead><tbody>";
          st.detail
            .sort((a, b) => a.time - b.time)
            .forEach(d => {
              html += `<tr>
                <td>${new Date(d.time).toLocaleString()}</td>
                <td>${d.category}</td>
                <td>${d.restaurant}</td>
                <td>${d.item}</td>
              </tr>`;
            });
          html += "</tbody></table>";
        } else {
          html += "<small>尚未有訂單。</small>";
        }
        html += '<div class="section-divider"></div>';
      });
      statsArea.innerHTML = html;
    }

    // ===== 事件綁定 =====
    roleSelect.addEventListener("change", () => {
      const role = roleSelect.value;
      if (role === "admin") {
        adminLoginArea.classList.remove("hidden");
        userPanel.classList.add("hidden");
      } else {
        adminLoginArea.classList.add("hidden");
        adminPanel.classList.add("hidden");
        userPanel.classList.remove("hidden");
        isAdmin = false;
        currentRoleText.textContent = "目前身分：一般使用者";
      }
    });

    adminLoginBtn.addEventListener("click", () => {
      const pwd = adminPasswordInput.value;
      if (pwd === ADMIN_PASSWORD) {
        isAdmin = true;
        adminPanel.classList.remove("hidden");
        userPanel.classList.add("hidden");
        currentRoleText.textContent = "目前身分：管理員";
        adminPasswordInput.value = "";
        renderStats();
      } else {
        alert("密碼錯誤");
      }
    });

    adminLogoutBtn.addEventListener("click", () => {
      isAdmin = false;
      adminPanel.classList.add("hidden");
      userPanel.classList.remove("hidden");
      roleSelect.value = "user";
      adminLoginArea.classList.add("hidden");
      currentRoleText.textContent = "目前身分：一般使用者";
    });

    userDeptSelect.addEventListener("change", () => {
      refreshUserNameOptions();
      renderUserOrders();
    });

    userNameSelect.addEventListener("change", () => {
      renderUserOrders();
    });

    categorySelect.addEventListener("change", () => {
      refreshRestaurantOptionsForUser();
    });

    restaurantSelect.addEventListener("change", () => {
      refreshItemOptionsForUser();
    });

    placeOrderBtn.addEventListener("click", () => {
      userMessage.textContent = "";
      const dept = userDeptSelect.value;
      const personId = userNameSelect.value;
      const category = categorySelect.value;
      const restaurantId = restaurantSelect.value;
      const itemId = itemSelect.value;

      if (!dept || !personId || !category || !restaurantId || !itemId) {
        userMessage.textContent = "請確認部門、姓名、餐別、餐廳與餐點都已選擇。";
        return;
      }

      const order = {
        id: "o_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        personId,
        restaurantId,
        itemId,
        time: Date.now()
      };
      data.orders.push(order);
      saveData();
      renderUserOrders();
      renderStats();
      userMessage.style.color = "#0a0";
      userMessage.textContent = "已送出訂單！";
      setTimeout(() => {
        userMessage.textContent = "";
      }, 2000);
    });

    addPersonBtn.addEventListener("click", () => {
      const name = adminPersonName.value.trim();
      const dept = adminPersonDept.value;
      if (!name) {
        alert("請輸入姓名");
        return;
      }
      const person = {
        id: "p_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        name,
        department: dept
      };
      data.people.push(person);
      saveData();
      adminPersonName.value = "";
      refreshPeopleList();
      refreshUserNameOptions();
      renderStats();
    });

    addRestaurantBtn.addEventListener("click", () => {
      const cat = adminRestaurantCategory.value;
      const name = adminRestaurantName.value.trim();
      if (!name) {
        alert("請輸入餐廳名稱");
        return;
      }
      const restaurant = {
        id: "r_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        name,
        category: cat
      };
      data.restaurants.push(restaurant);
      saveData();
      adminRestaurantName.value = "";
      refreshRestaurantList();
      refreshRestaurantOptionsForUser();
    });

    addItemBtn.addEventListener("click", () => {
      const restaurantId = adminItemRestaurant.value;
      const name = adminItemName.value.trim();
      if (!restaurantId) {
        alert("請選擇餐廳");
        return;
      }
      if (!name) {
        alert("請輸入餐點名稱");
        return;
      }
      const item = {
        id: "i_" + Date.now() + "_" + Math.random().toString(16).slice(2),
        restaurantId,
        name
      };
      data.items.push(item);
      saveData();
      adminItemName.value = "";
      refreshItemList();
      refreshItemOptionsForUser();
    });

    // ===== 初始化 =====
    function init() {
      initDepartmentSelects();
      refreshPeopleList();
      refreshRestaurantList();
      refreshItemList();
      currentRoleText.textContent = "目前身分：一般使用者";
      userPanel.classList.remove("hidden");
    }

    init();
  </script>
</body>
</html>


