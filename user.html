<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>使用者點餐 - GoldBricks</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#f5f4fb;color:#111827;padding:16px}
    .card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 8px 25px rgba(15,23,42,.08);margin-bottom:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input,select{height:36px;border:1px solid #d1d5db;border-radius:12px;padding:8px 10px;font-size:13px}
    button{height:36px;border:none;border-radius:999px;padding:0 14px;font-weight:900;cursor:pointer;background:linear-gradient(90deg,#fb7185,#f97316);color:#fff}
    .muted{color:#6b7280;font-size:13px}
  </style>
</head>
<body>

<div class="card">
  <div class="row" style="justify-content:space-between">
    <div>
      <div style="font-weight:900">GoldBricks 使用者</div>
      <div class="muted">此頁會自動匿名登入，允許寫入 orders</div>
    </div>
    <button id="btnGoAdmin" style="background:#111827">前往管理者</button>
  </div>
  <div class="row" style="margin-top:10px;">
    <span class="muted" id="authState">Auth：初始化中</span>
  </div>
</div>

<div class="card">
  <div style="font-weight:900;margin-bottom:10px;">測試下單（寫入 orders）</div>
  <div class="row">
    <input id="dept" autocomplete="off" placeholder="部門">
    <input id="person" autocomplete="off" placeholder="姓名">
    <input id="restaurantName" autocomplete="off" placeholder="店家">
    <input id="summary" autocomplete="off" placeholder="彙整，如：排骨飯*1">
    <input id="total" type="number" placeholder="金額">
    <button id="btnSend">送出</button>
  </div>
  <div class="muted" style="margin-top:8px">※ 真正點餐 UI 你原本那套之後再接上即可</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBdgOddTGAFqqHLnhnaJRv2_y7gyweuQEo",
    authDomain: "goldbricks-order.firebaseapp.com",
    projectId: "goldbricks-order",
    storageBucket: "goldbricks-order.firebasestorage.app",
    messagingSenderId: "463709758954",
    appId: "1:463709758954:web:429dc920f2f812d51cbe93"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 自動匿名登入（讓 orders.create 通過）
  await signInAnonymously(auth);

  onAuthStateChanged(auth, (user) => {
    document.getElementById("authState").textContent =
      user ? `Auth：已登入（匿名） ${user.uid.slice(0,6)}...` : "Auth：未登入";
  });

  document.getElementById("btnGoAdmin").addEventListener("click", () => {
    localStorage.setItem("role","admin");
    location.href = "index.html"; // 回入口登入
  });

  document.getElementById("btnSend").addEventListener("click", async () => {
    const payload = {
      date: new Date().toISOString().slice(0,10),
      dept: document.getElementById("dept").value.trim(),
      person: document.getElementById("person").value.trim(),
      restaurantName: document.getElementById("restaurantName").value.trim(),
      summary: document.getElementById("summary").value.trim(),
      total: Number(document.getElementById("total").value || 0),
      createdAt: Date.now()
    };
    try{
      await addDoc(collection(db,"orders"), payload);
      alert("已送出（寫入 orders）");
    }catch(e){
      console.error(e);
      alert("送出失敗：請確認 Firestore Rules 的 orders.create 已允許 signed-in（匿名算）");
    }
  });
</script>
</body>
</html>
