<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoldBricks â€” ä½¿ç”¨è€…é»é¤</title>
<style>
  :root{
    --bg:#020617;
    --bg-soft:#020617;
    --panel:#0b1120;
    --panel2:#020617;
    --border:#1e293b;
    --accent:#3b82f6;
    --accent2:#0ea5e9;
    --text:#e5e7eb;
    --text-soft:#9ca3af;
    --danger:#ef4444;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:radial-gradient(circle at top,#1d3557 0,#020617 55%);
    color:var(--text);
  }

  /* ä¸Šæ–¹åˆ— */
  .top-bar{
    position:sticky;
    top:0;
    z-index:20;
    padding:10px 14px;
    display:flex;
    align-items:center;
    gap:10px;
    background:rgba(15,23,42,0.9);
    backdrop-filter:blur(16px);
    border-bottom:1px solid var(--border);
  }
  .logo{
    font-size:20px;
    font-weight:700;
  }
  .search-wrap{
    flex:1;
    display:flex;
    gap:6px;
  }
  .search-wrap input{
    flex:1;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--text);
    font-size:14px;
  }
  .search-wrap input::placeholder{color:var(--text-soft);}
  .search-btn{
    padding:8px 12px;
    border-radius:999px;
    border:none;
    background:linear-gradient(120deg,var(--accent),var(--accent2));
    color:#fff;
    font-size:13px;
  }

  /* åˆ‡æ›ç®¡ç†è€… */
  .admin-switch{
    margin-left:4px;
  }
  .admin-switch button{
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--text-soft);
    font-size:12px;
  }

  main{
    max-width:1200px;
    margin:0 auto;
    padding:14px 14px 40px;
  }

  .card{
    background:linear-gradient(145deg,#020617,#020617 55%,#020617);
    border-radius:18px;
    border:1px solid rgba(148,163,184,0.3);
    padding:16px 16px 18px;
    box-shadow:0 18px 60px rgba(15,23,42,0.7);
    margin-bottom:14px;
  }
  .card-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    margin-bottom:10px;
  }
  .card-title{
    font-size:18px;
    font-weight:700;
  }
  .card-sub{
    font-size:12px;
    color:var(--text-soft);
  }

  label{
    font-size:13px;
    color:var(--text-soft);
    display:block;
    margin-bottom:3px;
  }
  select,input[type="text"],input[type="number"],input[type="date"]{
    width:100%;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--text);
    font-size:14px;
  }
  .field{margin-bottom:10px;}

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:4px;
    padding:8px 14px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    font-size:14px;
  }
  .btn-primary{
    background:linear-gradient(120deg,var(--accent),var(--accent2));
    color:#fff;
  }
  .btn-outline{
    background:transparent;
    border:1px solid var(--border);
    color:var(--text-soft);
  }
  .btn-sm{
    padding:4px 8px;
    font-size:12px;
  }

  .two-col{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:10px;
  }

  /* é¤å»³ç¶²æ ¼ */
  .rest-grid{
    margin-top:10px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
    gap:10px;
  }
  @media(min-width:1200px){
    .rest-grid{grid-template-columns:repeat(5,1fr);}
  }
  .rest-card{
    background:rgba(15,23,42,0.96);
    border-radius:18px;
    overflow:hidden;
    border:1px solid rgba(148,163,184,0.35);
    cursor:pointer;
    transition:transform .15s, box-shadow .15s, border-color .15s;
  }
  .rest-card:hover,
  .rest-card.active{
    transform:translateY(-2px);
    border-color:var(--accent);
    box-shadow:0 14px 40px rgba(15,23,42,0.9);
  }
  .rest-img{
    width:100%;
    aspect-ratio:4/3;
    background:linear-gradient(135deg,#1d4ed8,#0ea5e9);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
  }
  .rest-body{
    padding:8px 10px 10px;
  }
  .rest-name{
    font-size:14px;
    font-weight:600;
  }
  .rest-meta{
    font-size:11px;
    color:var(--text-soft);
    margin-top:2px;
  }

  /* èœå–® + è³¼ç‰©è»Š */
  .menu-layout{
    display:grid;
    grid-template-columns:1.2fr 1fr;
    gap:12px;
  }
  @media(max-width:900px){
    .menu-layout{grid-template-columns:1fr;}
  }

  .menu-panel{
    background:var(--panel);
    border-radius:16px;
    border:1px solid var(--border);
    padding:10px 10px 12px;
  }
  .menu-section-title{
    font-size:15px;
    font-weight:600;
    margin:8px 0 4px;
  }
  .menu-item{
    border-radius:12px;
    border:1px solid var(--border);
    padding:8px 10px;
    margin-bottom:6px;
    background:var(--panel2);
    font-size:13px;
  }
  .menu-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:4px;
  }
  .menu-name{
    font-weight:600;
  }
  .menu-price{
    font-size:13px;
  }
  .menu-extra{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin-top:4px;
  }
  .addon-pill{
    display:inline-flex;
    align-items:center;
    gap:4px;
    padding:3px 8px;
    border-radius:999px;
    border:1px solid var(--border);
    font-size:11px;
    background:#020617;
    color:var(--text-soft);
  }
  .qty-box{
    display:flex;
    align-items:center;
    gap:4px;
    margin-top:4px;
  }
  .qty-box input{
    width:60px;
    text-align:center;
  }

  /* è³¼ç‰©è»Š */
  .cart{
    background:var(--panel);
    border-radius:16px;
    border:1px solid var(--border);
    padding:10px 10px 12px;
  }
  .cart-list{
    max-height:260px;
    overflow:auto;
    margin-top:4px;
  }
  .cart-item{
    border-bottom:1px solid var(--border);
    padding:6px 0;
    font-size:13px;
  }
  .cart-item:last-child{border-bottom:none;}
  .cart-line{
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .cart-name{
    font-weight:600;
  }
  .cart-meta{
    font-size:12px;
    color:var(--text-soft);
  }
  .del-btn{
    border:none;
    background:transparent;
    color:var(--danger);
    font-size:16px;
    cursor:pointer;
  }
  .total-area{
    margin-top:8px;
    font-size:14px;
  }
  .exceed{
    color:var(--danger);
    font-weight:700;
  }

  /* è¨‚å–®ç´€éŒ„ */
  table{
    width:100%;
    border-collapse:collapse;
    font-size:12px;
    margin-top:6px;
  }
  th,td{
    padding:4px 4px;
    border-bottom:1px solid var(--border);
  }
  th{
    color:var(--text-soft);
    text-align:left;
    font-weight:500;
  }
  .text-right{text-align:right;}
</style>
</head>
<body>

<!-- ä¸Šæ–¹åˆ— -->
<div class="top-bar">
  <div class="logo">GoldBricks</div>
  <div class="search-wrap">
    <input id="searchInput" placeholder="æœå°‹é¤å»³åç¨±â€¦">
    <button class="search-btn" id="searchBtn">æœå°‹</button>
  </div>
  <div class="admin-switch">
    <button onclick="switchToAdmin()">ç®¡ç†è€…</button>
  </div>
</div>

<main>

  <!-- ä½¿ç”¨è€…è³‡è¨Š -->
  <section class="card">
    <div class="card-header">
      <div class="card-title">ä½¿ç”¨è€…è³‡è¨Š</div>
      <div class="card-sub">è«‹å…ˆé¸æ“‡éƒ¨é–€èˆ‡äººå“¡ï¼Œå†é–‹å§‹é»é¤</div>
    </div>
    <div class="two-col">
      <div class="field">
        <label>éƒ¨é–€</label>
        <select id="deptSelect">
          <option value="">è«‹é¸æ“‡éƒ¨é–€</option>
        </select>
      </div>
      <div class="field">
        <label>äººå“¡</label>
        <select id="staffSelect">
          <option value="">è«‹é¸æ“‡äººå“¡</option>
        </select>
      </div>
    </div>
    <button class="btn btn-primary" id="startBtn">é–‹å§‹é»é¤</button>
  </section>

  <!-- é¤å»³åˆ—è¡¨ -->
  <section class="card" id="restCard" style="display:none;">
    <div class="card-header">
      <div class="card-title">é¸æ“‡é¤å»³</div>
      <div class="card-sub" id="userInfoLabel"></div>
    </div>
    <div class="rest-grid" id="restGrid"></div>
  </section>

  <!-- èœå–® + è³¼ç‰©è»Š -->
  <section class="card" id="menuCard" style="display:none;">
    <div class="card-header">
      <div class="card-title" id="currentRestName">èœå–®</div>
      <div class="card-sub">é»é¸é¤é»ï¼Œå¯å‹¾é¸åŠ è³¼é …ç›®ï¼Œå†åŠ å…¥æ¸…å–®</div>
    </div>
    <div class="menu-layout">
      <div class="menu-panel">
        <div id="menuList"></div>
      </div>
      <div class="cart">
        <div class="card-title" style="font-size:16px;">å·²é¸é¤é»</div>
        <div class="cart-list" id="cartList"></div>
        <div class="total-area">
          ç¸½é‡‘é¡ï¼š<span id="totalPrice">0</span> å…ƒ
          <br>
          <span id="budgetNote" class=""></span>
        </div>
        <button class="btn btn-primary" id="submitOrderBtn" style="margin-top:8px;width:100%;">é€å‡ºè¨‚å–®</button>
      </div>
    </div>
  </section>

  <!-- è¨‚è³¼ç´€éŒ„ -->
  <section class="card">
    <div class="card-header">
      <div class="card-title">è¨‚è³¼ç´€éŒ„</div>
      <div class="card-sub">å¯ä¾æ—¥æœŸèˆ‡æ¢ä»¶æŸ¥è©¢æ­·å²è¨‚å–®</div>
    </div>
    <div class="two-col">
      <div class="field">
        <label>èµ·å§‹æ—¥</label>
        <input type="date" id="histStart">
      </div>
      <div class="field">
        <label>çµæŸæ—¥</label>
        <input type="date" id="histEnd">
      </div>
      <div class="field">
        <label>ç¯©é¸é¡å‹</label>
        <select id="histMode">
          <option value="store">åº—å®¶</option>
          <option value="dept">éƒ¨é–€</option>
          <option value="staff">äººå“¡</option>
        </select>
      </div>
      <div class="field">
        <label>é—œéµå­—ï¼ˆåº—å®¶ / éƒ¨é–€ / äººå“¡ï¼‰</label>
        <input type="text" id="histKeyword" placeholder="è¼¸å…¥è¦æŸ¥è©¢çš„åç¨±â€¦">
      </div>
    </div>
    <button class="btn btn-outline" id="histSearchBtn">æŸ¥è©¢è¨‚è³¼ç´€éŒ„</button>

    <div id="histResult"></div>
  </section>

</main>

<script>
// è§’è‰²æª¢æŸ¥ï¼šä¸æ˜¯ user å°±å›ç™»å…¥é 
(function(){
  const role = localStorage.getItem('gb_role');
  if(role !== 'user'){
    window.location.href = 'index.html';
  }
})();

function switchToAdmin(){
  localStorage.setItem('gb_role','admin');
  window.location.href='index.html';
}

// è®€å–ç®¡ç†è€…å„²å­˜çš„è³‡æ–™ï¼ˆä¹‹å¾Œ admin.html è¦è¨˜å¾—å­˜é€² localStorageï¼‰
const staffData   = JSON.parse(localStorage.getItem('gb_staff') || '[]');
const restaurants = JSON.parse(localStorage.getItem('gb_rest')  || '[]');
const menuItems   = JSON.parse(localStorage.getItem('gb_menu')  || '[]');
const orders      = JSON.parse(localStorage.getItem('gb_orders')|| '[]');

const deptSelect  = document.getElementById('deptSelect');
const staffSelect = document.getElementById('staffSelect');
const startBtn    = document.getElementById('startBtn');
const restCard    = document.getElementById('restCard');
const menuCard    = document.getElementById('menuCard');
const restGrid    = document.getElementById('restGrid');
const menuList    = document.getElementById('menuList');
const currentRestName = document.getElementById('currentRestName');
const userInfoLabel   = document.getElementById('userInfoLabel');

const cart = [];
let currentRestId = null;

// åˆå§‹åŒ–éƒ¨é–€ / äººå“¡æ¸…å–®
function initStaff(){
  if(!staffData.length){
    // è‹¥ç®¡ç†è€…é‚„æ²’å»ºï¼Œæ”¾é è¨­å‡è³‡æ–™è®“ä½ å¯ä»¥å…ˆæ¸¬è©¦
    const demo = [
      {dept:'æ¥­å‹™ä¸€éƒ¨', staff:'ç‹å°æ˜'},
      {dept:'å·¥ç¨‹éƒ¨',   staff:'æ—å°è¯'}
    ];
    demo.forEach(d => staffData.push(d));
  }

  // éƒ¨é–€é¸é …ï¼ˆç”¨ Set å»é‡ï¼‰
  const deptSet = new Set(staffData.map(s => s.dept));
  deptSet.forEach(d=>{
    const op=document.createElement('option');
    op.value=d;
    op.textContent=d;
    deptSelect.appendChild(op);
  });

  // ä¾éƒ¨é–€æ›´æ–°äººå“¡
  deptSelect.addEventListener('change',updateStaffSelect);
  updateStaffSelect();
}
function updateStaffSelect(){
  const dept = deptSelect.value;
  staffSelect.innerHTML='<option value="">è«‹é¸æ“‡äººå“¡</option>';
  staffData
    .filter(s => !dept || s.dept===dept)
    .forEach(s=>{
      const op=document.createElement('option');
      op.value=s.staff;
      op.textContent=s.staff;
      staffSelect.appendChild(op);
    });
}
initStaff();

// é–‹å§‹é»é¤
startBtn.addEventListener('click',()=>{
  const dept = deptSelect.value;
  const staff = staffSelect.value;
  if(!dept || !staff){
    alert('è«‹å…ˆé¸æ“‡éƒ¨é–€èˆ‡äººå“¡');
    return;
  }
  userInfoLabel.textContent=`${dept}ï¼${staff}`;
  restCard.style.display='block';
  renderRestaurants();
});

// é¤å»³åˆ—è¡¨
function renderRestaurants(){
  restGrid.innerHTML='';
  if(!restaurants.length){
    const tip=document.createElement('div');
    tip.style.color='#9ca3af';
    tip.style.fontSize='13px';
    tip.textContent='ç›®å‰å°šæœªç”±ç®¡ç†è€…è¨­å®šé¤å»³è³‡æ–™ã€‚';
    restGrid.appendChild(tip);
    return;
  }

  restaurants.forEach(r=>{
    const card=document.createElement('div');
    card.className='rest-card';
    card.dataset.id=r.id;
    card.innerHTML=`
      <div class="rest-img">ğŸ±</div>
      <div class="rest-body">
        <div class="rest-name">${r.name}</div>
        <div class="rest-meta">${r.addr || ''}</div>
      </div>
    `;
    card.addEventListener('click',()=>{
      document.querySelectorAll('.rest-card').forEach(c=>c.classList.remove('active'));
      card.classList.add('active');
      currentRestId = r.id;
      currentRestName.textContent = r.name + ' â€” èœå–®';
      menuCard.style.display='block';
      buildMenuForRestaurant(r.id);
    });
    restGrid.appendChild(card);
  });
}

// æœå°‹é¤å»³
const searchInput=document.getElementById('searchInput');
const searchBtn=document.getElementById('searchBtn');
function doSearch(){
  const kw = searchInput.value.trim().toLowerCase();
  document.querySelectorAll('.rest-card').forEach(card=>{
    const name = card.querySelector('.rest-name').textContent.toLowerCase();
    card.style.display = !kw || name.includes(kw) ? 'block' : 'none';
  });
}
searchBtn.addEventListener('click',doSearch);
searchInput.addEventListener('keydown',e=>{
  if(e.key==='Enter'){e.preventDefault();doSearch();}
});

// ç”¢ç”ŸæŸé¤å»³èœå–®
function buildMenuForRestaurant(restId){
  menuList.innerHTML='';
  const items = menuItems.filter(m=>String(m.restId)===String(restId));
  if(!items.length){
    const p=document.createElement('p');
    p.style.fontSize='13px';
    p.style.color='#9ca3af';
    p.textContent='æ­¤é¤å»³å°šæœªè¨­å®šèœå–®ï¼Œè«‹é€šçŸ¥ç®¡ç†å“¡ã€‚';
    menuList.appendChild(p);
    return;
  }

  const cats = Array.from(new Set(items.map(i=>i.cat || 'æœªåˆ†é¡')));
  cats.forEach(cat=>{
    const secTitle=document.createElement('div');
    secTitle.className='menu-section-title';
    secTitle.textContent=cat;
    menuList.appendChild(secTitle);

    items.filter(i=>(i.cat||'æœªåˆ†é¡')===cat).forEach(item=>{
      const box=document.createElement('div');
      box.className='menu-item';

      const addons = item.addons || [];

      box.innerHTML=`
        <div class="menu-header">
          <div class="menu-name">${item.name}</div>
          <div class="menu-price">$${item.price}</div>
        </div>
        <div class="menu-extra">
          ${addons.length ? addons.map((a,idx)=>`
            <label class="addon-pill">
              <input type="checkbox" data-addon-index="${idx}">
              ${a.name}${a.free ? 'ï¼ˆå…è²»ï¼‰' : (a.price ? ` +${a.price}` : '')}
            </label>
          `).join('') : '<span class="menu-extra" style="font-size:12px;color:#64748b;">ç„¡åŠ è³¼é …ç›®</span>'}
        </div>
        <div class="qty-box">
          <span style="font-size:12px;color:#9ca3af;">æ•¸é‡</span>
          <input type="number" min="1" value="1">
          <button class="btn btn-sm btn-primary">åŠ å…¥</button>
        </div>
      `;

      const qtyInput = box.querySelector('input[type="number"]');
      const addBtn   = box.querySelector('.btn-primary');

      addBtn.addEventListener('click',()=>{
        const qty = Number(qtyInput.value||1);
        if(qty<1){alert('æ•¸é‡è‡³å°‘ç‚º 1');return;}

        const chosenAddons=[];
        box.querySelectorAll('input[type="checkbox"]').forEach(chk=>{
          if(chk.checked){
            const idx = Number(chk.dataset.addonIndex);
            const a = addons[idx];
            chosenAddons.push({
              name:a.name,
              price:a.free ? 0 : Number(a.price||0),
              free:a.free
            });
          }
        });

        addToCart({
          restId:item.restId,
          restName:item.restName,
          cat:item.cat,
          name:item.name,
          basePrice:Number(item.price),
          qty,
          addons:chosenAddons
        });
      });

      menuList.appendChild(box);
    });
  });
}

// åŠ å…¥è³¼ç‰©è»Š
function addToCart(item){
  cart.push(item);
  renderCart();
}

// é¡¯ç¤ºè³¼ç‰©è»Š
const cartList   = document.getElementById('cartList');
const totalPrice = document.getElementById('totalPrice');
const budgetNote = document.getElementById('budgetNote');
const BUDGET = 140;

function renderCart(){
  cartList.innerHTML='';
  let total=0;

  cart.forEach((c,index)=>{
    const addonText = c.addons && c.addons.length
      ? c.addons.map(a=>a.free ? `${a.name}(å…è²»)` : `${a.name}+${a.price}`).join('ã€')
      : 'ç„¡';

    const addonTotal = c.addons.reduce((s,a)=>s+(a.free?0:Number(a.price||0)),0);
    const lineTotal  = (c.basePrice + addonTotal) * c.qty;
    total += lineTotal;

    const row=document.createElement('div');
    row.className='cart-item';
    row.innerHTML=`
      <div class="cart-line">
        <div>
          <div class="cart-name">${c.name} Ã— ${c.qty}</div>
          <div class="cart-meta">åŠ è³¼ï¼š${addonText}</div>
        </div>
        <div>
          <span>$${lineTotal}</span>
          <button class="del-btn" title="åˆªé™¤">Ã—</button>
        </div>
      </div>
    `;
    row.querySelector('.del-btn').addEventListener('click',()=>{
      if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†é¤é»å—ï¼Ÿ')){
        cart.splice(index,1);
        renderCart();
      }
    });
    cartList.appendChild(row);
  });

  totalPrice.textContent = total;

  if(total > BUDGET){
    budgetNote.textContent = `é ç®— ${BUDGET} å…ƒï¼Œè¶…å‡º ${total-BUDGET} å…ƒï¼ˆæ‡‰æ”¯ä»˜é‡‘é¡ï¼‰`;
    budgetNote.className='exceed';
  }else if(total === 0){
    budgetNote.textContent = '';
    budgetNote.className='';
  }else{
    budgetNote.textContent = `é ç®— ${BUDGET} å…ƒä»¥å…§`;
    budgetNote.className='';
  }
}

// é€å‡ºè¨‚å–®
document.getElementById('submitOrderBtn').addEventListener('click',()=>{
  if(!cart.length){
    alert('å°šæœªé¸æ“‡ä»»ä½•é¤é»');
    return;
  }
  const dept  = deptSelect.value;
  const staff = staffSelect.value;
  if(!dept || !staff){
    alert('è«‹å…ˆé¸æ“‡éƒ¨é–€èˆ‡äººå“¡');
    return;
  }
  if(!currentRestId){
    alert('è«‹å…ˆé¸æ“‡é¤å»³');
    return;
  }

  if(!confirm('é€å‡ºè¨‚å–®å¾Œå°‡ç„¡æ³•åœ¨ç·šä¸Šä¿®æ”¹ï¼Œç¢ºèªé€å‡ºï¼Ÿ')) return;

  const total = Number(totalPrice.textContent||0);
  const order = {
    id:Date.now(),
    createdAt:new Date().toISOString(),
    dept,
    staff,
    restId:currentRestId,
    restName:(restaurants.find(r=>String(r.id)===String(currentRestId))||{}).name || '',
    items:cart.map(c=>({
      cat:c.cat,
      name:c.name,
      qty:c.qty,
      basePrice:c.basePrice,
      addons:c.addons
    })),
    total
  };
  orders.push(order);
  localStorage.setItem('gb_orders',JSON.stringify(orders));

  // æ¸…ç©ºè³¼ç‰©è»Š
  cart.length=0;
  renderCart();
  alert('å·²é€å‡ºè¨‚å–®ï¼');
});

// è¨‚è³¼ç´€éŒ„æŸ¥è©¢
const histStart   = document.getElementById('histStart');
const histEnd     = document.getElementById('histEnd');
const histMode    = document.getElementById('histMode');
const histKeyword = document.getElementById('histKeyword');
const histResult  = document.getElementById('histResult');

document.getElementById('histSearchBtn').addEventListener('click',()=>{
  renderHistory();
});

function renderHistory(){
  histResult.innerHTML='';
  if(!orders.length){
    const p=document.createElement('p');
    p.style.fontSize='13px';
    p.style.color='#9ca3af';
    p.textContent='ç›®å‰å°šç„¡ä»»ä½•è¨‚å–®ç´€éŒ„ã€‚';
    histResult.appendChild(p);
    return;
  }

  const s = histStart.value ? new Date(histStart.value+'T00:00:00') : null;
  const e = histEnd.value   ? new Date(histEnd.value+'T23:59:59') : null;
  const mode = histMode.value; // store / dept / staff
  const kw   = histKeyword.value.trim();

  const filtered = orders.filter(o=>{
    const t = new Date(o.createdAt);
    if(s && t < s) return false;
    if(e && t > e) return false;

    if(kw){
      if(mode==='store' && !o.restName.includes(kw)) return false;
      if(mode==='dept'  && !o.dept.includes(kw))      return false;
      if(mode==='staff' && !o.staff.includes(kw))     return false;
    }
    return true;
  });

  if(!filtered.length){
    const p=document.createElement('p');
    p.style.fontSize='13px';
    p.style.color='#9ca3af';
    p.textContent='æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„è¨‚å–®ã€‚';
    histResult.appendChild(p);
    return;
  }

  const table=document.createElement('table');
  table.innerHTML=`
    <thead>
      <tr>
        <th>æ—¥æœŸæ™‚é–“</th>
        <th>éƒ¨é–€</th>
        <th>äººå“¡</th>
        <th>åº—å®¶</th>
        <th>é¤é»é¡åˆ¥ / åç¨±</th>
        <th class="text-right">å–®åƒ¹</th>
        <th class="text-right">æ•¸é‡</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;
  const tbody=table.querySelector('tbody');

  filtered.forEach(o=>{
    o.items.forEach(it=>{
      const tr=document.createElement('tr');
      const dt = new Date(o.createdAt);
      const dateStr = dt.toLocaleString('zh-TW',{hour12:false});
      tr.innerHTML=`
        <td>${dateStr}</td>
        <td>${o.dept}</td>
        <td>${o.staff}</td>
        <td>${o.restName}</td>
        <td>${(it.cat||'') + ' / ' + it.name}</td>
        <td class="text-right">${it.basePrice}</td>
        <td class="text-right">${it.qty}</td>
      `;
      tbody.appendChild(tr);
    });
  });

  histResult.appendChild(table);
}

// ç¬¬ä¸€æ¬¡è¼‰å…¥å°±ç•«ä¸€æ¬¡ï¼ˆæ–¹ä¾¿çœ‹åˆ°ç›®å‰æœ‰æ²’æœ‰è³‡æ–™ï¼‰
renderHistory();
</script>

</body>
</html>
