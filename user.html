<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GoldBricks 呷奔啊~~ ｜使用者</title>

  <style>
    :root{
      --bg:#f5f4fb; --card:#fff; --text:#0f172a; --muted:#64748b;
      --primary:#fb7185; --primary2:#ff9a9e; --border:rgba(15,23,42,.10);
      --shadow:0 10px 30px rgba(15,23,42,.10);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial;
      background:
        radial-gradient(1200px 500px at 20% -10%, rgba(251,113,133,.22), transparent 60%),
        radial-gradient(900px 500px at 100% 0%, rgba(255,154,158,.14), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:16px;}
    .topbar{
      background:rgba(255,255,255,.78);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter:blur(10px);
      padding:12px 14px;
      display:flex;justify-content:space-between;align-items:center;gap:12px;
    }
    .topbar h1{margin:0;font-size:18px}
    .right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .pill{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;color:var(--muted);font-size:12.5px}
    .btn{padding:9px 12px;border-radius:14px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:900}
    .primary{
      padding:9px 12px;border-radius:14px;border:none;cursor:pointer;font-weight:900;
      background:linear-gradient(90deg,var(--primary),var(--primary2));
      color:#fff;
      box-shadow:0 14px 28px rgba(251,113,133,.22);
    }
    .btn:disabled,.primary:disabled{opacity:.55;cursor:not-allowed}

    .grid{display:grid;grid-template-columns:1.25fr .85fr;gap:14px;margin-top:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{
      background:#fff;border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:0 8px 25px rgba(15,23,42,.07);padding:14px;
    }
    .card h2{margin:0 0 10px;font-size:15px}

    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input,select,textarea{
      width:100%;padding:11px 12px;border-radius:14px;border:1px solid var(--border);
      font-size:14px;outline:none
    }
    textarea{min-height:92px}
    input:focus,select:focus,textarea:focus{border-color:rgba(251,113,133,.7)}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .muted{color:var(--muted);font-size:12.5px}
    .hr{height:1px;background:var(--border);margin:12px 0}
    .tag{padding:5px 10px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:12px}

    .restaurantGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (max-width:980px){.restaurantGrid{grid-template-columns:1fr}}

    /* ===== 餐廳卡片 ===== */
    .rCard{
      border:1px solid rgba(15,23,42,.10);
      border-radius:16px;
      overflow:hidden;
      background:#fff;
      cursor:pointer;
      transition:.12s transform;
      pointer-events:auto;
    }
    .rCard:hover{transform:translateY(-1px)}
    .rCard.active{
      border-color:rgba(251,113,133,.55);
      box-shadow:0 10px 22px rgba(251,113,133,.18);
    }

    .rImg{width:100%;height:160px;object-fit:cover;background:rgba(15,23,42,.04)}
    .rBody{padding:10px 12px}
    .rBody h3{margin:0;font-size:15px}

    /* ✅ 關鍵修正：狀態標籤不吃點擊 */
    .rBody .tag{pointer-events:none}

    /* ===== 結單提示 ===== */
    .banner{
      display:none;
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(239,68,68,.35);
      background:rgba(239,68,68,.06);
      color:#7f1d1d;
      font-weight:900;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div>
      <h1>使用者點餐</h1>
      <div class="muted" id="whoLine">尚未選擇使用者</div>
    </div>
    <div class="right">
      <span class="pill" id="statusPill">連線中</span>
      <button class="btn" id="btnLogout">登出</button>
    </div>
  </div>

  <div class="grid">
    <div>
      <div class="card">
        <h2>1）使用者資訊</h2>
        <div class="row">
          <select id="userDept"></select>
          <select id="userName" disabled></select>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <h2>2）選擇餐廳</h2>
        <div id="restaurantList" class="restaurantGrid"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <h2>3）選擇餐點</h2>
        <div id="closedBanner" class="banner">此店家已結單</div>
        <div id="menuWrap" class="muted">請先選擇餐廳</div>
      </div>
    </div>

    <div>
      <div class="card">
        <h2>購物車</h2>
        <div id="cartWrap" class="muted">尚未加入餐點</div>
        <div class="hr"></div>
        <button class="primary" id="btnSubmit" disabled>送出</button>
      </div>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBdgOddTGAfqqHLnhnaJRv2_y7gyweuQEo",
  authDomain: "goldbricks-order.firebaseapp.com",
  projectId: "goldbricks-order"
});
const db = getFirestore(app);

const $ = id => document.getElementById(id);

let restaurants = [];
let selectedRestaurantId = "";

async function loadRestaurants(){
  const snap = await getDocs(collection(db,"restaurants"));
  restaurants = [];
  snap.forEach(d=>{
    const r = d.data();
    if(r.isVisible === false) return;
    restaurants.push({id:d.id,...r});
  });
  renderRestaurants();
}

function renderRestaurants(){
  $("restaurantList").innerHTML = restaurants.map(r=>`
    <div class="rCard" data-id="${r.id}">
      <div class="rBody">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>${r.name||"未命名"}</h3>
          <span class="tag">${r.isClosed?"已結單":"開單中"}</span>
        </div>
      </div>
    </div>
  `).join("");

  document.querySelectorAll(".rCard").forEach(card=>{
    card.onclick = ()=>{
      selectedRestaurantId = card.dataset.id;
      document.querySelectorAll(".rCard").forEach(c=>c.classList.remove("active"));
      card.classList.add("active");
      $("menuWrap").textContent = "✅ 可以進來選餐了（點擊正常）";
    };
  });
}

await loadRestaurants();
</script>
</body>
</html>
