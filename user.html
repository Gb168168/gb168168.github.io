<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä½¿ç”¨è€…é»é¤</title>
  <style>
    :root{
      --bg:#f5f4fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --line:#e8eaf3;
      --primary:#fb7185;
      --danger:#ef4444;
      --shadow:0 10px 30px rgba(15,23,42,.08);
      --r:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Noto Sans TC", Arial;
      background:linear-gradient(135deg,#eef2ff 0%, #f5f4fb 45%, #fff1f2 100%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background:rgba(245,244,251,.7);
      border-bottom:1px solid rgba(232,234,243,.8);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .topbar{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:linear-gradient(135deg,var(--primary),#ffd5c2);
      box-shadow: 0 10px 18px rgba(251,113,133,.25);
    }
    h1{margin:0;font-size:18px}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(232,234,243,.9);
      background:rgba(255,255,255,.6);
      display:flex; gap:8px; align-items:center;
      white-space:nowrap;
    }
    main{padding:16px 0 40px}
    .grid{display:grid;grid-template-columns: 1fr;gap:16px;}

    .card{
      background:rgba(255,255,255,.9);
      border:1px solid rgba(232,234,243,.9);
      box-shadow:var(--shadow);
      border-radius:var(--r);
      overflow:hidden;
    }
    .cardHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(232,234,243,.9);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:linear-gradient(90deg, rgba(99,102,241,.05), rgba(251,113,133,.08));
      flex-wrap:wrap;
    }
    .cardHead h2{margin:0;font-size:14px}
    .cardBody{padding:14px 16px}
    .hint{font-size:12px;color:var(--muted);line-height:1.5}

    .restaurants{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 900px){ .restaurants{grid-template-columns: repeat(2, minmax(0,1fr));} }
    @media (max-width: 560px){ .restaurants{grid-template-columns: 1fr;} }

    .rCard{
      border:1px solid rgba(232,234,243,.95);
      background:rgba(255,255,255,.85);
      border-radius:18px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .rCard:hover{ transform: translateY(-1px); box-shadow: 0 16px 30px rgba(15,23,42,.10); }
    .thumb{height:120px;background:#f8fafc;border-bottom:1px solid rgba(232,234,243,.95);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px;}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .rInfo{padding:10px 12px}
    .rTitle{font-weight:900;font-size:14px;margin:0 0 4px}
    .rMeta{margin:0;color:var(--muted);font-size:12px;line-height:1.4}

    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:rgba(15,23,42,.92);
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      opacity:0; pointer-events:none;
      transition:opacity .18s ease, transform .18s ease;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(-4px); }

    button{
      border:none;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:800;
      font-size:14px;
    }
    .btnGhost{
      background:rgba(255,255,255,.8);
      border:1px solid rgba(232,234,243,.95);
      color:var(--text);
    }
    .inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    input{
      border:1px solid rgba(232,234,243,.95);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>ä½¿ç”¨è€…é»é¤</h1>
          <div class="sub">é»é¤å»³çœ‹èœå–®ï¼ˆåªé¡¯ç¤ºä¸Šæ¶é¤é»ï¼‰</div>
        </div>
      </div>

      <div class="inline">
        <div class="pill">æƒ³åˆ‡ç®¡ç†è€…ï¼Ÿè¼¸å…¥ 8520 â†’</div>
        <input id="adminCode" placeholder="8520" style="width:120px" />
        <button class="btnGhost" id="btnToAdmin">åˆ‡æ›</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div class="cardHead">
      <h2>é¤å»³åˆ—è¡¨</h2>
      <span class="hint" id="counts">0 é¤å»³</span>
    </div>
    <div class="cardBody">
      <div class="hint" style="margin-bottom:10px;">ï¼ˆé€™é å…ˆåšåˆ‡æ›ï¼‹é¡¯ç¤ºé¤å»³ï¼›ä½ å¾ŒçºŒè¦çš„é»é¤æµç¨‹æˆ‘ä¹Ÿèƒ½æ¥è‘—è£œä¸Šï¼‰</div>
      <div class="restaurants" id="restaurantList"></div>
      <div id="empty" class="hint" style="display:none;">
        ç›®å‰æ²’æœ‰é¤å»³è³‡æ–™ã€‚è«‹åˆ‡åˆ°ç®¡ç†è€…æ–°å¢é¤å»³èˆ‡é¤é»ã€‚
      </div>
    </div>
  </section>
</main>

<div class="toast" id="toast">æç¤º</div>

<script>
  const STORE_KEY = "jabenlo_data_v2";
  const ADMIN_FLAG_KEY = "jabenlo_is_admin";
  const ADMIN_CODE = "8520";

  const $ = (id)=> document.getElementById(id);

  function toast(msg){
    const el = $("toast");
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(window.__t);
    window.__t = setTimeout(()=> el.classList.remove("show"), 1200);
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      const data = raw ? JSON.parse(raw) : { restaurants: [], staff: [] };
      data.restaurants = Array.isArray(data.restaurants) ? data.restaurants : [];
      return data;
    }catch(e){
      return { restaurants: [], staff: [] };
    }
  }

  function render(){
    const data = load();
    $("counts").textContent = `${data.restaurants.length} é¤å»³`;

    const box = $("restaurantList");
    box.innerHTML = "";

    $("empty").style.display = data.restaurants.length ? "none" : "block";

    data.restaurants.forEach(r=>{
      const card = document.createElement("div");
      card.className = "rCard";
      card.onclick = ()=> toast("ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¹«ä½ åšï¼šé€²é¤å»³â†’é¸é¤â†’é€å‡ºâ†’è¨‚é¤ç´€éŒ„");

      const thumb = document.createElement("div");
      thumb.className = "thumb";
      if(r.photo){
        const img = document.createElement("img");
        img.src = r.photo;
        img.alt = r.name;
        img.onerror = ()=> thumb.textContent = "åœ–ç‰‡è¼‰å…¥å¤±æ•—";
        thumb.appendChild(img);
      }else{
        thumb.textContent = "å°šæœªè¨­å®šåº—å®¶åœ–ç‰‡";
      }

      const info = document.createElement("div");
      info.className = "rInfo";

      const title = document.createElement("p");
      title.className = "rTitle";
      title.textContent = r.name || "(æœªå‘½å)";

      const meta = document.createElement("p");
      meta.className = "rMeta";
      const addr = r.address ? `ğŸ“ ${r.address}` : "";
      const openItems = Array.isArray(r.menu) ? r.menu.filter(x=> x.enabled !== false).length : 0;
      meta.textContent = [addr, `ğŸ± ä¸Šæ¶ ${openItems} é“`].filter(Boolean).join("  Â·  ");

      info.appendChild(title);
      info.appendChild(meta);

      card.appendChild(thumb);
      card.appendChild(info);
      box.appendChild(card);
    });
  }

  $("btnToAdmin").addEventListener("click", ()=>{
    const code = ($("adminCode").value || "").trim();
    if(code !== ADMIN_CODE){
      toast("å¯†ç¢¼éŒ¯èª¤");
      return;
    }
    localStorage.setItem(ADMIN_FLAG_KEY, "1");
    location.href = "admin.html";
  });

  // Enter ä¹Ÿå¯åˆ‡
  $("adminCode").addEventListener("keydown", (e)=>{
    if(e.key === "Enter") $("btnToAdmin").click();
  });

  // åˆå§‹åŒ–ï¼šå¦‚æœç›®å‰å·²æ˜¯ adminï¼Œç›´æ¥å°åˆ° admin
  if(localStorage.getItem(ADMIN_FLAG_KEY) === "1"){
    location.href = "admin.html";
  }else{
    render();
  }
</script>
</body>
</html>
