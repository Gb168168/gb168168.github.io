<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoldBricks ‚Äî ‰ΩøÁî®ËÄÖÈªûÈ§ê</title>
<style>
  :root {
    --bg: #020617;
    --bg-soft: #0b1120;
    --panel: #0f172a;
    --border: #1e293b;
    --accent: #3b82f6;
    --text: #e5e7eb;
    --text-soft: #9ca3af;
    --danger: #ef4444;
  }
  * { box-sizing: border-box; }
  body {
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #020617;
    color: var(--text);
  }

  .top-bar{
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px 14px;
    background:#0f172a;
    border-bottom:1px solid var(--border);
    position:sticky;
    top:0;
    z-index:20;
  }
  .logo{
    font-size:20px;
    font-weight:700;
    margin-right:6px;
  }
  .search-wrap{
    flex:1;
    display:flex;
    gap:6px;
  }
  .search-wrap input{
    flex:1;
    padding:8px 12px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:#fff;
  }
  .search-btn{
    padding:8px 12px;
    border-radius:999px;
    border:none;
    background:var(--accent);
    color:white;
  }

  main{
    padding:16px;
    max-width:1200px;
    margin:0 auto;
  }

  .card{
    background:#0f172a;
    border:1px solid #1e293b;
    padding:16px;
    border-radius:16px;
    margin-bottom:16px;
  }
  .card-title{
    font-size:18px;
    font-weight:700;
    margin-bottom:10px;
  }

  .two-col{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:10px;
  }

  label{
    display:block;
    font-size:13px;
    margin-bottom:4px;
    color:var(--text-soft);
  }
  input, select{
    width:100%;
    padding:8px 10px;
    border-radius:10px;
    border:1px solid var(--border);
    background:#020617;
    color:#fff;
  }

  .btn{
    padding:10px 14px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-size:14px;
    margin-top:10px;
  }
  .btn-primary{
    background:var(--accent);
    color:white;
  }

  /* È§êÂª≥ */
  .rest-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
    gap:10px;
    margin-top:10px;
  }
  @media(min-width:1200px){
    .rest-grid{ grid-template-columns:repeat(5,1fr); }
  }

  .rest-card{
    background:#0f172a;
    border:1px solid var(--border);
    border-radius:14px;
    cursor:pointer;
    overflow:hidden;
    transition:0.2s;
  }
  .rest-card:hover{
    transform:translateY(-3px);
    border-color:var(--accent);
  }
  .rest-card.active{
    border-color:var(--accent);
  }
  .rest-img{
    width:100%;
    height:110px;
    background:#1e293b;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:20px;
  }
  .rest-title{
    padding:10px;
    font-size:14px;
    font-weight:600;
  }

  /* ËèúÂñÆ */
  .menu-layout{
    margin-top:16px;
    display:grid;
    grid-template-columns:1.2fr 1fr;
    gap:16px;
  }
  @media(max-width:900px){
    .menu-layout{ grid-template-columns:1fr; }
  }

  .menu-item{
    background:#0f172a;
    border:1px solid var(--border);
    padding:10px;
    border-radius:12px;
    margin-bottom:6px;
  }
  .menu-title{
    font-size:15px;
    font-weight:600;
  }
  .addon-list{
    font-size:13px;
    color:var(--text-soft);
  }

  /* Ë≥ºÁâ©Ëªä */
  .cart{
    background:#0f172a;
    border:1px solid var(--border);
    padding:14px;
    border-radius:14px;
  }
  .cart-item{
    padding:8px;
    border-bottom:1px solid var(--border);
    font-size:14px;
  }
  .cart-item:last-child{ border-bottom:none; }
  .delete-btn{
    background:none;
    border:none;
    color:var(--danger);
    font-size:18px;
    float:right;
    cursor:pointer;
  }
  .total{
    margin-top:10px;
    font-size:16px;
    font-weight:700;
  }
  .exceed{
    color:var(--danger);
    font-weight:700;
  }
</style>
</head>
<body>

<!-- ‰∏äÊñπÂàó -->
<div class="top-bar">
  <div class="logo">GoldBricks</div>
  <div class="search-wrap">
    <input id="searchInput" placeholder="ÊêúÂ∞ãÈ§êÂª≥ÂêçÁ®±‚Ä¶">
    <button class="search-btn" id="searchBtn">ÊêúÂ∞ã</button>
  </div>
</div>

<main>

<!-- ‰∫∫Âì°Ë≥áË®ä -->
<div class="card">
  <div class="card-title">‰ΩøÁî®ËÄÖË≥áË®ä</div>
  <div class="two-col">
    <div>
      <label>ÈÉ®ÈñÄ</label>
      <select id="deptSelect"></select>
    </div>
    <div>
      <label>‰∫∫Âì°</label>
      <select id="staffSelect"></select>
    </div>
  </div>
  <button class="btn btn-primary" id="startBtn">ÈñãÂßãÈªûÈ§ê</button>
</div>

<!-- È§êÂª≥ÈÅ∏Êìá -->
<div class="card" id="restSection" style="display:none;">
  <div class="card-title">ÈÅ∏ÊìáÈ§êÂª≥</div>
  <div class="rest-grid" id="restGrid"></div>
</div>

<!-- ËèúÂñÆ + Ë≥ºÁâ©Ëªä -->
<div class="menu-layout" id="menuLayout" style="display:none;">

  <!-- ËèúÂñÆ -->
  <div id="menuList"></div>

  <!-- Ë≥ºÁâ©Ëªä -->
  <div class="cart">
    <div class="card-title">Â∑≤ÈÅ∏È§êÈªû</div>
    <div id="cartList"></div>
    <div class="total">
      Á∏ΩÈáëÈ°çÔºö<span id="totalPrice">0</span> ÂÖÉ  
      <span id="exceedNote"></span>
    </div>
  </div>

</div>

</main>

<script>
(function(){
  const role = localStorage.getItem("gb_role");
  if(role !== "user") window.location.href="index.html";
})();

const restaurants = [];
const menuItems = [];
const cart = [];
let selectedRestaurant = null;

const deptSelect = document.getElementById("deptSelect");
const staffSelect = document.getElementById("staffSelect");

// Âæû localStorage ËÆÄÂèñÁÆ°ÁêÜËÄÖÊñ∞Â¢ûÁöÑË≥áÊñôÔºà‰∫∫Âì° & È§êÂª≥ & ËèúÂñÆÔºâ
function loadData(){
  const staff = JSON.parse(localStorage.getItem("gb_staff")||"[]");
  const rest  = JSON.parse(localStorage.getItem("gb_rest")||"[]");
  const menu  = JSON.parse(localStorage.getItem("gb_menu")||"[]");

  staff.forEach(s=>{
    let opt = document.createElement("option");
    opt.textContent = s.dept;
    deptSelect.appendChild(opt);

    let opt2 = document.createElement("option");
    opt2.textContent = s.staff;
    staffSelect.appendChild(opt2);
  });

  restaurants.push(...rest);
  menuItems.push(...menu);
}
loadData();

// ÈñãÂßãÈªûÈ§ê
document.getElementById("startBtn").addEventListener("click",()=>{
  document.getElementById("restSection").style.display="block";
});

// È°ØÁ§∫È§êÂª≥
const restGrid = document.getElementById("restGrid");

function renderRestaurants(){
  restGrid.innerHTML="";
  restaurants.forEach(r=>{
    const card=document.createElement("div");
    card.className="rest-card";
    card.innerHTML=`
      <div class="rest-img">üçΩÔ∏è</div>
      <div class="rest-title">${r.name}</div>
    `;
    card.onclick=()=>{
      selectedRestaurant=r.id;
      document.getElementById("menuLayout").style.display="grid";
      showMenu(r.id);
    };
    restGrid.appendChild(card);
  });
}
renderRestaurants();

// È°ØÁ§∫ËèúÂñÆ
function showMenu(restId){
  const menuList=document.getElementById("menuList");
  menuList.innerHTML="";

  menuItems.filter(m=>m.restId===restId).forEach(item=>{
    const div=document.createElement("div");
    div.className="menu-item";
    div.innerHTML=`
      <div class="menu-title">${item.name} ‚Äî $${item.price}</div>
      <button class="btn btn-primary btn-sm">Âä†ÂÖ•</button>
    `;
    div.querySelector("button").onclick=()=>addToCart(item);
    menuList.appendChild(div);
  });
}

// Âä†ÂÖ•Ë≥ºÁâ©Ëªä
function addToCart(item){
  cart.push({...item});
  renderCart();
}

// È°ØÁ§∫Ë≥ºÁâ©Ëªä
function renderCart(){
  const box=document.getElementById("cartList");
  const total = document.getElementById("totalPrice");
  const exceed = document.getElementById("exceedNote");

  box.innerHTML="";

  let sum=0;
  cart.forEach((c,i)=>{
    sum+=c.price;
    const row=document.createElement("div");
    row.className="cart-item";
    row.innerHTML=`
      ${c.name} ‚Äî $${c.price}
      <button class="delete-btn">√ó</button>
    `;
    row.querySelector("button").onclick=()=>{
      cart.splice(i,1);
      renderCart();
    };
    box.appendChild(row);
  });

  total.textContent=sum;

  if(sum>140){
    exceed.textContent=`ÔºàË∂ÖÂá∫ ${sum-140} ÂÖÉÔºâ`;
    exceed.className="exceed";
  }else{
    exceed.textContent="";
    exceed.className="";
  }
}

</script>

</body>
</html>
